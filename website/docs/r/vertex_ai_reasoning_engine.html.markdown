---
# ----------------------------------------------------------------------------
#
#     ***     AUTO GENERATED CODE    ***    Type: MMv1     ***
#
# ----------------------------------------------------------------------------
#
#     This code is generated by Magic Modules using the following:
#
#     Configuration: https:#github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/products/vertexai/ReasoningEngine.yaml
#     Template:      https:#github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/templates/terraform/resource.html.markdown.tmpl
#
#     DO NOT EDIT this file directly. Any changes made to this file will be
#     overwritten during the next generation cycle.
#
# ----------------------------------------------------------------------------
subcategory: "Vertex AI"
description: |-
  ReasoningEngine provides a customizable runtime for models to determine which actions to take and in which order.
---

# google_vertex_ai_reasoning_engine

ReasoningEngine provides a customizable runtime for models to determine which actions to take and in which order.


To get more information about ReasoningEngine, see:

* [API documentation](https://cloud.google.com/vertex-ai/docs/reference/rest/v1/projects.locations.reasoningEngines/)
* How-to Guides
    * [Develop and deploy agents on Vertex AI Agent Engine](https://cloud.google.com/vertex-ai/generative-ai/docs/agent-engine/quickstart)

<div class = "oics-button" style="float: right; margin: 0 0 -15px">
  <a href="https://console.cloud.google.com/cloudshell/open?cloudshell_git_repo=https%3A%2F%2Fgithub.com%2Fterraform-google-modules%2Fdocs-examples.git&cloudshell_image=gcr.io%2Fcloudshell-images%2Fcloudshell%3Alatest&cloudshell_print=.%2Fmotd&cloudshell_tutorial=.%2Ftutorial.md&cloudshell_working_dir=vertex_ai_reasoning_engine_source_based_deployment&open_in_editor=main.tf" target="_blank">
    <img alt="Open in Cloud Shell" src="//gstatic.com/cloudssh/images/open-btn.svg" style="max-height: 44px; margin: 32px auto; max-width: 100%;">
  </a>
</div>
## Example Usage - Vertex Ai Reasoning Engine Source Based Deployment


```hcl
resource "google_vertex_ai_reasoning_engine" "reasoning_engine" {
  display_name = "reasoning-engine"
  description  = "A basic reasoning engine"
  region       = "us-central1"

  spec {
    source_code_spec {
      inline_source {
        source_archive = filebase64("./test-fixtures/source.tar.gz")
      }

      python_spec {
        entrypoint_module = "simple_agent"
        entrypoint_object = "fixed_name_generator"
        requirements_file = "./test-fixtures/requirements.txt"
        version           = "3.11"
      }
    }
  }
}
```
## Example Usage - Vertex Ai Reasoning Engine Psc Interface


```hcl
# When PSC-I is configured, Agent deletion will fail,
# although the agent will be deleted.
# Bug at https://github.com/hashicorp/terraform-provider-google/issues/25637

resource "google_vertex_ai_reasoning_engine" "reasoning_engine" {
  display_name = "reasoning-engine"
  description  = "A basic reasoning engine"
  region       = "us-central1"

  spec {
    agent_framework = "google-adk"

    package_spec {
      python_version           = "3.11"
      dependency_files_gcs_uri = "${google_storage_bucket.bucket.url}/${google_storage_bucket_object.bucket_obj_dependencies_tar_gz.name}"
      pickle_object_gcs_uri    = "${google_storage_bucket.bucket.url}/${google_storage_bucket_object.bucket_obj_pickle.name}"
      requirements_gcs_uri     = "${google_storage_bucket.bucket.url}/${google_storage_bucket_object.bucket_obj_requirements_txt.name}"
    }

    deployment_spec {

      psc_interface_config {
        network_attachment = google_compute_network_attachment.network_attachment.id

        dns_peering_configs {
          domain         = "example.com."
          target_project = data.google_project.project.project_id
          target_network = google_compute_network.network.name
        }
      }
    }
  }

  depends_on = [
    time_sleep.wait_35_minutes
  ]
}

resource "google_storage_bucket_object" "bucket_obj_requirements_txt" {
  name   = "requirements.txt"
  bucket = google_storage_bucket.bucket.id
  source = "./test-fixtures/requirements_adk.txt"
}

resource "google_storage_bucket_object" "bucket_obj_pickle" {
  name   = "code.pkl"
  bucket = google_storage_bucket.bucket.id
  source = "./test-fixtures/pickle_adk.pkl"
}

resource "google_storage_bucket_object" "bucket_obj_dependencies_tar_gz" {
  name   = "dependencies.tar.gz"
  bucket = google_storage_bucket.bucket.id
  source = "./test-fixtures/dependencies_adk.tar.gz"
}

resource "google_storage_bucket" "bucket" {
  name                        = "reasoning-engine"
  location                    = "us-central1"
  uniform_bucket_level_access = true
  force_destroy               = true
}

# Destroy network attachment 35 minutes after reasoning engine is deleted.
# It guarantees that the network attachment has no more active PSC interfaces.
resource "time_sleep" "wait_35_minutes" {
  destroy_duration = "35m"

  depends_on = [
    google_compute_network_attachment.network_attachment
  ]
}

resource "google_compute_network_attachment" "network_attachment" {
  name                  = "network-attachment"
  region                = "us-central1"
  connection_preference = "ACCEPT_MANUAL"

  subnetworks = [
    google_compute_subnetwork.subnetwork.id
  ]
}

resource "google_compute_subnetwork" "subnetwork" {
  name          = "subnetwork"
  region        = "us-central1"
  ip_cidr_range = "10.0.0.0/16"
  network       = google_compute_network.network.id
}

resource "google_compute_network" "network" {
  name                    = "network"
  auto_create_subnetworks = false
}

data "google_project" "project" {
}
```
<div class = "oics-button" style="float: right; margin: 0 0 -15px">
  <a href="https://console.cloud.google.com/cloudshell/open?cloudshell_git_repo=https%3A%2F%2Fgithub.com%2Fterraform-google-modules%2Fdocs-examples.git&cloudshell_image=gcr.io%2Fcloudshell-images%2Fcloudshell%3Alatest&cloudshell_print=.%2Fmotd&cloudshell_tutorial=.%2Ftutorial.md&cloudshell_working_dir=vertex_ai_reasoning_engine_full&open_in_editor=main.tf" target="_blank">
    <img alt="Open in Cloud Shell" src="//gstatic.com/cloudssh/images/open-btn.svg" style="max-height: 44px; margin: 32px auto; max-width: 100%;">
  </a>
</div>
## Example Usage - Vertex Ai Reasoning Engine Full


```hcl
# Generate pickle files with the cloudpickle library:
#
# local_agent = LangchainAgent(
#   model=MODEL,
#   agent_executor_kwargs={"return_intermediate_steps": True},
# )
#
# output_filename = "pickle.pkl"
#
# with open(output_filename, "wb") as f:
#   cloudpickle.dump(local_agent, f)

locals {
  class_methods = [
    {
      api_mode = "async"
      description = null
      name = "async_query"
      parameters = {
        type     = "object"
        required = []
        properties = {}
      }
    }
  ]
}

resource "google_vertex_ai_reasoning_engine" "reasoning_engine" {
  display_name = "reasoning-engine"
  description  = "A basic reasoning engine"
  region       = "us-central1"

  encryption_spec {
    kms_key_name = "example-key"
  }

  spec {
    agent_framework = "google-adk"
    class_methods   = jsonencode(local.class_methods)
    service_account = google_service_account.service_account.email

    deployment_spec {
      min_instances         = 1
      max_instances         = 3
      container_concurrency = 5

      resource_limits = {
        cpu    = "4"
        memory = "4Gi"
      }

      env {
        name  = "var_1"
        value = "value_2"
      }

      env {
        name  = "var_2"
        value = "value_2"
      }

      secret_env {
        name = "secret_var_1"

        secret_ref {
          secret  = google_secret_manager_secret.secret.secret_id
          version = "latest"
        }
      }

      secret_env {
        name = "secret_var_2"

        secret_ref {
          secret  = google_secret_manager_secret.secret.secret_id
          version = "latest"
        }
      }
    }

    package_spec {
      dependency_files_gcs_uri = "${google_storage_bucket.bucket.url}/${google_storage_bucket_object.bucket_obj_dependencies_tar_gz.name}"
      pickle_object_gcs_uri    = "${google_storage_bucket.bucket.url}/${google_storage_bucket_object.bucket_obj_pickle.name}"
      python_version           = "3.11"
      requirements_gcs_uri     = "${google_storage_bucket.bucket.url}/${google_storage_bucket_object.bucket_obj_requirements_txt.name}"
    }
  }

  depends_on = [
    time_sleep.wait_5_minutes
  ]
}

# Ensure we wait enough time for IAM permissions to be propagated
resource "time_sleep" "wait_5_minutes" {
  create_duration = "5m"

  depends_on = [
    google_project_iam_member.sa_iam_ai_platform_user,
    google_project_iam_member.sa_iam_object_viewer,
    google_project_iam_member.sa_iam_viewer,
    google_secret_manager_secret_iam_member.secret_access,
    google_secret_manager_secret_version.secret_version
  ]
}

resource "google_secret_manager_secret_version" "secret_version" {
  secret      = google_secret_manager_secret.secret.id
  secret_data = "test"
}

resource "google_secret_manager_secret" "secret" {
  secret_id = "secret"

  replication {
    auto {}
  }
}

resource "google_secret_manager_secret_iam_member" "secret_access" {
  secret_id  = google_secret_manager_secret.secret.id
  role       = "roles/secretmanager.secretAccessor"
  member     = google_service_account.service_account.member
}

resource "google_storage_bucket" "bucket" {
  name                        = "reasoning-engine"
  location                    = "us-central1"
  uniform_bucket_level_access = true
  force_destroy               = true
}

resource "google_storage_bucket_object" "bucket_obj_requirements_txt" {
  name   = "requirements.txt"
  bucket = google_storage_bucket.bucket.id
  source = "./test-fixtures/requirements_adk.txt"
}

resource "google_storage_bucket_object" "bucket_obj_pickle" {
  name   = "code.pkl"
  bucket = google_storage_bucket.bucket.id
  source = "./test-fixtures/pickle_adk.pkl"
}

resource "google_storage_bucket_object" "bucket_obj_dependencies_tar_gz" {
  name   = "dependencies.tar.gz"
  bucket = google_storage_bucket.bucket.id
  source = "./test-fixtures/dependencies_adk.tar.gz"
}

resource "google_service_account" "service_account" {
  account_id = "sa"
}

resource "google_project_iam_member" "sa_iam_object_viewer" {
  role    = "roles/storage.objectViewer"
  project = data.google_project.project.id
  member  = google_service_account.service_account.member
}

resource "google_project_iam_member" "sa_iam_ai_platform_user" {
  role    = "roles/aiplatform.user"
  project = data.google_project.project.id
  member  = google_service_account.service_account.member
}

resource "google_project_iam_member" "sa_iam_viewer" {
  role    = "roles/viewer"
  project = data.google_project.project.id
  member  = google_service_account.service_account.member
}

data "google_project" "project" {
}
```

## Argument Reference

The following arguments are supported:


* `display_name` -
  (Required)
  The display name of the ReasoningEngine.


* `description` -
  (Optional)
  The description of the ReasoningEngine.

* `encryption_spec` -
  (Optional)
  Optional. Customer-managed encryption key spec for a ReasoningEngine.
  If set, this ReasoningEngine and all sub-resources of this ReasoningEngine
  will be secured by this key.
  Structure is [documented below](#nested_encryption_spec).

* `spec` -
  (Optional)
  Optional. Configurations of the ReasoningEngine.
  Structure is [documented below](#nested_spec).

* `region` -
  (Optional)
  The region of the reasoning engine. eg us-central1

* `project` - (Optional) The ID of the project in which the resource belongs.
    If it is not provided, the provider project is used.



<a name="nested_encryption_spec"></a>The `encryption_spec` block supports:

* `kms_key_name` -
  (Required)
  Required. The Cloud KMS resource identifier of the customer managed
  encryption key used to protect a resource. Has the form:
  projects/my-project/locations/my-region/keyRings/my-kr/cryptoKeys/my-key.
  The key needs to be in the same region as where the compute resource
  is created.

<a name="nested_spec"></a>The `spec` block supports:

* `agent_framework` -
  (Optional)
  Optional. The OSS agent framework used to develop the agent.

* `class_methods` -
  (Optional)
  Optional. Declarations for object class methods in OpenAPI
  specification format.

* `deployment_spec` -
  (Optional)
  Optional. The specification of a Reasoning Engine deployment.
  Structure is [documented below](#nested_spec_deployment_spec).

* `package_spec` -
  (Optional)
  Optional. User provided package spec of the ReasoningEngine.
  Ignored when users directly specify a deployment image through
  deploymentSpec.first_party_image_override, but keeping the
  field_behavior to avoid introducing breaking changes.
  Structure is [documented below](#nested_spec_package_spec).

* `source_code_spec` -
  (Optional)
  Specification for deploying from source code.
  Structure is [documented below](#nested_spec_source_code_spec).

* `service_account` -
  (Optional)
  Optional. The service account that the Reasoning Engine artifact runs
  as. It should have "roles/storage.objectViewer" for reading the user
  project's Cloud Storage and "roles/aiplatform.user" for using Vertex
  extensions. If not specified, the Vertex AI Reasoning Engine service
  Agent in the project will be used.


<a name="nested_spec_deployment_spec"></a>The `deployment_spec` block supports:

* `env` -
  (Optional)
  Optional. Environment variables to be set with the Reasoning
  Engine deployment.
  Structure is [documented below](#nested_spec_deployment_spec_env).

* `secret_env` -
  (Optional)
  Optional. Environment variables where the value is a secret in
  Cloud Secret Manager. To use this feature, add 'Secret Manager
  Secret Accessor' role (roles/secretmanager.secretAccessor) to AI
  Platform Reasoning Engine service Agent.
  Structure is [documented below](#nested_spec_deployment_spec_secret_env).

* `psc_interface_config` -
  (Optional)
  Optional. Configuration for PSC-Interface.
  Structure is [documented below](#nested_spec_deployment_spec_psc_interface_config).

* `resource_limits` -
  (Optional)
  Optional. Resource limits for each container.
  Only 'cpu' and 'memory' keys are supported.
  Defaults to {"cpu": "4", "memory": "4Gi"}.
  The only supported values for CPU are '1', '2', '4', '6' and '8'.
  For more information, go to
  https://cloud.google.com/run/docs/configuring/cpu.
  The only supported values for memory are '1Gi', '2Gi', ... '32 Gi'.
  For more information, go to
  https://cloud.google.com/run/docs/configuring/memory-limits.

* `min_instances` -
  (Optional)
  Optional. The minimum number of application instances that will be
  kept running at all times. Defaults to 1. Range: [0, 10].

* `max_instances` -
  (Optional)
  Optional. The maximum number of application instances that can be
  launched to handle increased traffic. Defaults to 100.
  Range: [1, 1000]. If VPC-SC or PSC-I is enabled, the acceptable
  range is [1, 100].

* `container_concurrency` -
  (Optional)
  Optional. Concurrency for each container and agent server.
  Recommended value: 2 * cpu + 1. Defaults to 9.


<a name="nested_spec_deployment_spec_env"></a>The `env` block supports:

* `name` -
  (Required)
  The name of the environment variable. Must be a valid
  C identifier.

* `value` -
  (Required)
  Variables that reference a $(VAR_NAME) are expanded using
  the previous defined environment variables in the container
  and any service environment variables. If a variable cannot
  be resolved, the reference in the input string will be
  unchanged. The $(VAR_NAME) syntax can be escaped with a
  double $$, ie: $$(VAR_NAME). Escaped references will never
  be expanded, regardless of whether the variable exists
  or not.

<a name="nested_spec_deployment_spec_secret_env"></a>The `secret_env` block supports:

* `name` -
  (Required)
  The name of the environment variable. Must be a valid C
  identifier.

* `secret_ref` -
  (Required)
  Reference to a secret stored in the Cloud Secret Manager
  that will provide the value for this environment variable.
  Structure is [documented below](#nested_spec_deployment_spec_secret_env_secret_ref).


<a name="nested_spec_deployment_spec_secret_env_secret_ref"></a>The `secret_ref` block supports:

* `secret` -
  (Required)
  The name of the secret in Cloud Secret Manager.
  Format: {secret_name}.

* `version` -
  (Optional)
  The Cloud Secret Manager secret version. Can be 'latest'
  for the latest version, an integer for a specific
  version, or a version alias.

<a name="nested_spec_deployment_spec_psc_interface_config"></a>The `psc_interface_config` block supports:

* `network_attachment` -
  (Optional)
  Optional. The name of the Compute Engine network attachment
  to attach to the resource within the region and user project.
  To specify this field, you must have already created a network attachment.
  This field is only used for resources using PSC-Interface.

* `dns_peering_configs` -
  (Optional)
  Optional. DNS peering configurations.
  When specified, Vertex AI will attempt to configure DNS
  peering zones in the tenant project VPC to resolve the
  specified domains using the target network's Cloud DNS.
  The user must grant the dns.peer role to the Vertex AI
  service Agent on the target project.
  Structure is [documented below](#nested_spec_deployment_spec_psc_interface_config_dns_peering_configs).


<a name="nested_spec_deployment_spec_psc_interface_config_dns_peering_configs"></a>The `dns_peering_configs` block supports:

* `domain` -
  (Required)
  Required. The DNS name suffix of the zone being peered
  to, e.g., "my-internal-domain.corp.".
  Must end with a dot.

* `target_project` -
  (Required)
  Required. The project id hosting the Cloud DNS managed
  zone that contains the 'domain'.
  The Vertex AI service Agent requires the dns.peer role
  on this project.

* `target_network` -
  (Required)
  Required. The VPC network name in the targetProject
  where the DNS zone specified by 'domain' is visible.

<a name="nested_spec_package_spec"></a>The `package_spec` block supports:

* `dependency_files_gcs_uri` -
  (Optional)
  Optional. The Cloud Storage URI of the dependency files in tar.gz
  format.

* `pickle_object_gcs_uri` -
  (Optional)
  Optional. The Cloud Storage URI of the pickled python object.

* `python_version` -
  (Optional)
  Optional. The Python version. Currently support 3.8, 3.9, 3.10,
  3.11, 3.12, 3.13. If not specified, default value is 3.10.

* `requirements_gcs_uri` -
  (Optional)
  Optional. The Cloud Storage URI of the requirements.txtfile

<a name="nested_spec_source_code_spec"></a>The `source_code_spec` block supports:

* `inline_source` -
  (Optional)
  Source code is provided directly in the request.
  Structure is [documented below](#nested_spec_source_code_spec_inline_source).

* `python_spec` -
  (Optional)
  Specification for running a Python application from source.
  Structure is [documented below](#nested_spec_source_code_spec_python_spec).


<a name="nested_spec_source_code_spec_inline_source"></a>The `inline_source` block supports:

* `source_archive` -
  (Optional)
  Required. Input only.
  The application source code archive, provided as a compressed
  tarball (.tar.gz) file. A base64-encoded string.

<a name="nested_spec_source_code_spec_python_spec"></a>The `python_spec` block supports:

* `entrypoint_module` -
  (Optional)
  Optional. The Python module to load as the entrypoint,
  specified as a fully qualified module name. For example:
  path.to.agent. If not specified, defaults to "agent".
  The project root will be added to Python sys.path, allowing
  imports to be specified relative to the root.

* `entrypoint_object` -
  (Optional)
  Optional. The name of the callable object within the
  entrypointModule to use as the application If not specified,
  defaults to "root_agent".

* `requirements_file` -
  (Optional)
  Optional. The path to the requirements file, relative to the
  source root. If not specified, defaults to "requirements.txt".

* `version` -
  (Optional)
  Optional. The version of Python to use. Support version
  includes 3.9, 3.10, 3.11, 3.12, 3.13. If not specified,
  default value is 3.10.

## Attributes Reference

In addition to the arguments listed above, the following computed attributes are exported:

* `id` - an identifier for the resource with format `projects/{{project}}/locations/{{region}}/reasoningEngines/{{name}}`

* `name` -
  The generated name of the ReasoningEngine, in the format
  projects/{project}/locations/{location}/reasoningEngines/{reasoningEngine}

* `create_time` -
  The timestamp of when the Index was created in RFC3339 UTC "Zulu" format,
  with nanosecond resolution and up to nine fractional digits.

* `update_time` -
  The timestamp of when the Index was last updated in RFC3339 UTC "Zulu"
  format, with nanosecond resolution and up to nine fractional digits.


## Timeouts

This resource provides the following
[Timeouts](https://developer.hashicorp.com/terraform/plugin/sdkv2/resources/retries-and-customizable-timeouts) configuration options:

- `create` - Default is 20 minutes.
- `update` - Default is 20 minutes.
- `delete` - Default is 60 minutes.

## Import


ReasoningEngine can be imported using any of these accepted formats:

* `projects/{{project}}/locations/{{region}}/reasoningEngines/{{name}}`
* `{{project}}/{{region}}/{{name}}`
* `{{region}}/{{name}}`
* `{{name}}`


In Terraform v1.5.0 and later, use an [`import` block](https://developer.hashicorp.com/terraform/language/import) to import ReasoningEngine using one of the formats above. For example:

```tf
import {
  id = "projects/{{project}}/locations/{{region}}/reasoningEngines/{{name}}"
  to = google_vertex_ai_reasoning_engine.default
}
```

When using the [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import), ReasoningEngine can be imported using one of the formats above. For example:

```
$ terraform import google_vertex_ai_reasoning_engine.default projects/{{project}}/locations/{{region}}/reasoningEngines/{{name}}
$ terraform import google_vertex_ai_reasoning_engine.default {{project}}/{{region}}/{{name}}
$ terraform import google_vertex_ai_reasoning_engine.default {{region}}/{{name}}
$ terraform import google_vertex_ai_reasoning_engine.default {{name}}
```

## User Project Overrides

This resource supports [User Project Overrides](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference#user_project_override).

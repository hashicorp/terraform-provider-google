---
# ----------------------------------------------------------------------------
#
#     ***     AUTO GENERATED CODE    ***    Type: MMv1     ***
#
# ----------------------------------------------------------------------------
#
#     This code is generated by Magic Modules using the following:
#
#     Configuration: https:#github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/products/memorystore/Instance.yaml
#     Template:      https:#github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/templates/terraform/resource.html.markdown.tmpl
#
#     DO NOT EDIT this file directly. Any changes made to this file will be
#     overwritten during the next generation cycle.
#
# ----------------------------------------------------------------------------
subcategory: "Memorystore"
description: |-
  A Google Cloud Memorystore instance.
---

# google_memorystore_instance

A Google Cloud Memorystore instance.



<div class = "oics-button" style="float: right; margin: 0 0 -15px">
  <a href="https://console.cloud.google.com/cloudshell/open?cloudshell_git_repo=https%3A%2F%2Fgithub.com%2Fterraform-google-modules%2Fdocs-examples.git&cloudshell_image=gcr.io%2Fcloudshell-images%2Fcloudshell%3Alatest&cloudshell_print=.%2Fmotd&cloudshell_tutorial=.%2Ftutorial.md&cloudshell_working_dir=memorystore_instance_basic&open_in_editor=main.tf" target="_blank">
    <img alt="Open in Cloud Shell" src="//gstatic.com/cloudssh/images/open-btn.svg" style="max-height: 44px; margin: 32px auto; max-width: 100%;">
  </a>
</div>
## Example Usage - Memorystore Instance Basic


```hcl
resource "google_memorystore_instance" "instance-basic" {
  instance_id = "basic-instance"
  shard_count = 3
  desired_psc_auto_connections {
    network    = google_compute_network.producer_net.id
    project_id = data.google_project.project.project_id
  }
  location                    = "us-central1"
  deletion_protection_enabled = false
  depends_on = [
    google_network_connectivity_service_connection_policy.default
  ]

  lifecycle {
    prevent_destroy = "true"
  }
}

resource "google_network_connectivity_service_connection_policy" "default" {
  name          = "my-policy"
  location      = "us-central1"
  service_class = "gcp-memorystore"
  description   = "my basic service connection policy"
  network       = google_compute_network.producer_net.id
  psc_config {
    subnetworks = [google_compute_subnetwork.producer_subnet.id]
  }
}

resource "google_compute_subnetwork" "producer_subnet" {
  name          = "my-subnet"
  ip_cidr_range = "10.0.0.248/29"
  region        = "us-central1"
  network       = google_compute_network.producer_net.id
}

resource "google_compute_network" "producer_net" {
  name                    = "my-network"
  auto_create_subnetworks = false
}

data "google_project" "project" {
}
```
<div class = "oics-button" style="float: right; margin: 0 0 -15px">
  <a href="https://console.cloud.google.com/cloudshell/open?cloudshell_git_repo=https%3A%2F%2Fgithub.com%2Fterraform-google-modules%2Fdocs-examples.git&cloudshell_image=gcr.io%2Fcloudshell-images%2Fcloudshell%3Alatest&cloudshell_print=.%2Fmotd&cloudshell_tutorial=.%2Ftutorial.md&cloudshell_working_dir=memorystore_instance_full&open_in_editor=main.tf" target="_blank">
    <img alt="Open in Cloud Shell" src="//gstatic.com/cloudssh/images/open-btn.svg" style="max-height: 44px; margin: 32px auto; max-width: 100%;">
  </a>
</div>
## Example Usage - Memorystore Instance Full


```hcl
resource "google_memorystore_instance" "instance-full" {
  instance_id = "full-instance"
  shard_count = 3
  desired_psc_auto_connections {
    network    = google_compute_network.producer_net.id
    project_id = data.google_project.project.project_id
  }
  location                = "us-central1"
  replica_count           = 2
  node_type               = "SHARED_CORE_NANO"
  transit_encryption_mode = "TRANSIT_ENCRYPTION_DISABLED"
  authorization_mode      = "AUTH_DISABLED"
  engine_configs = {
    maxmemory-policy = "volatile-ttl"
  }
  zone_distribution_config {
    mode = "SINGLE_ZONE"
    zone = "us-central1-b"
  }
  engine_version              = "VALKEY_7_2"
  deletion_protection_enabled = false
  mode = "CLUSTER"
  persistence_config {
    mode = "RDB"
    rdb_config {
      rdb_snapshot_period     = "ONE_HOUR"
      rdb_snapshot_start_time = "2024-10-02T15:01:23Z"
    }
  }
  labels = {
    "abc" : "xyz"
  }
  depends_on = [
    google_network_connectivity_service_connection_policy.default
  ]

  lifecycle {
    prevent_destroy = "true"
  }
}

resource "google_network_connectivity_service_connection_policy" "default" {
  name          = "my-policy"
  location      = "us-central1"
  service_class = "gcp-memorystore"
  description   = "my basic service connection policy"
  network       = google_compute_network.producer_net.id
  psc_config {
    subnetworks = [google_compute_subnetwork.producer_subnet.id]
  }
}

resource "google_compute_subnetwork" "producer_subnet" {
  name          = "my-subnet"
  ip_cidr_range = "10.0.0.248/29"
  region        = "us-central1"
  network       = google_compute_network.producer_net.id
}

resource "google_compute_network" "producer_net" {
  name                    = "my-network"
  auto_create_subnetworks = false
}

data "google_project" "project" {
}
```
<div class = "oics-button" style="float: right; margin: 0 0 -15px">
  <a href="https://console.cloud.google.com/cloudshell/open?cloudshell_git_repo=https%3A%2F%2Fgithub.com%2Fterraform-google-modules%2Fdocs-examples.git&cloudshell_image=gcr.io%2Fcloudshell-images%2Fcloudshell%3Alatest&cloudshell_print=.%2Fmotd&cloudshell_tutorial=.%2Ftutorial.md&cloudshell_working_dir=memorystore_instance_persistence_aof&open_in_editor=main.tf" target="_blank">
    <img alt="Open in Cloud Shell" src="//gstatic.com/cloudssh/images/open-btn.svg" style="max-height: 44px; margin: 32px auto; max-width: 100%;">
  </a>
</div>
## Example Usage - Memorystore Instance Persistence Aof


```hcl
resource "google_memorystore_instance" "instance-persistence-aof" {
  instance_id = "aof-instance"
  shard_count = 3
  desired_psc_auto_connections {
    network    = google_compute_network.producer_net.id
    project_id = data.google_project.project.project_id
  }
  location = "us-central1"
  persistence_config {
    mode = "AOF"
    aof_config {
      append_fsync = "EVERY_SEC"
    }
  }
  depends_on = [
    google_network_connectivity_service_connection_policy.default
  ]
  deletion_protection_enabled = false
  lifecycle {
    prevent_destroy = "true"
  }
}

resource "google_network_connectivity_service_connection_policy" "default" {
  name          = "my-policy"
  location      = "us-central1"
  service_class = "gcp-memorystore"
  description   = "my basic service connection policy"
  network       = google_compute_network.producer_net.id
  psc_config {
    subnetworks = [google_compute_subnetwork.producer_subnet.id]
  }
}

resource "google_compute_subnetwork" "producer_subnet" {
  name          = "my-subnet"
  ip_cidr_range = "10.0.0.248/29"
  region        = "us-central1"
  network       = google_compute_network.producer_net.id
}

resource "google_compute_network" "producer_net" {
  name                    = "my-network"
  auto_create_subnetworks = false
}

data "google_project" "project" {
}
```

## Argument Reference

The following arguments are supported:


* `shard_count` -
  (Required)
  Required. Number of shards for the instance.

* `location` -
  (Required)
  Resource ID segment making up resource `name`. It identifies the resource within its parent collection as described in https://google.aip.dev/122. See documentation for resource type `memorystore.googleapis.com/CertificateAuthority`.

* `instance_id` -
  (Required)
  Required. The ID to use for the instance, which will become the final component of
  the instance's resource name.
  This value is subject to the following restrictions:
  * Must be 4-63 characters in length
  * Must begin with a letter or digit
  * Must contain only lowercase letters, digits, and hyphens
  * Must not end with a hyphen
  * Must be unique within a location


- - -


* `labels` -
  (Optional)
  Optional. Labels to represent user-provided metadata. 
  **Note**: This field is non-authoritative, and will only manage the labels present in your configuration.
  Please refer to the field `effective_labels` for all of the labels present on the resource.

* `replica_count` -
  (Optional)
  Optional. Number of replica nodes per shard. If omitted the default is 0 replicas.

* `authorization_mode` -
  (Optional)
  Optional. Immutable. Authorization mode of the instance. Possible values:
   AUTH_DISABLED
  IAM_AUTH

* `transit_encryption_mode` -
  (Optional)
  Optional. Immutable. In-transit encryption mode of the instance. 
   Possible values:
   TRANSIT_ENCRYPTION_DISABLED
  SERVER_AUTHENTICATION

* `node_type` -
  (Optional)
  Optional. Immutable. Machine type for individual nodes of the instance. 
   Possible values:
   SHARED_CORE_NANO
  HIGHMEM_MEDIUM
  HIGHMEM_XLARGE
  STANDARD_SMALL

* `persistence_config` -
  (Optional)
  Represents persistence configuration for a instance.
  Structure is [documented below](#nested_persistence_config).

* `engine_version` -
  (Optional)
  Optional. Engine version of the instance.

* `engine_configs` -
  (Optional)
  Optional. User-provided engine configurations for the instance.

* `zone_distribution_config` -
  (Optional)
  Zone distribution configuration for allocation of instance resources.
  Structure is [documented below](#nested_zone_distribution_config).

* `deletion_protection_enabled` -
  (Optional)
  Optional. If set to true deletion of the instance will fail.

* `mode` -
  (Optional)
  Optional. cluster or cluster-disabled. 
   Possible values:
   CLUSTER
   CLUSTER_DISABLED
  Possible values are: `CLUSTER`, `CLUSTER_DISABLED`.

* `project` - (Optional) The ID of the project in which the resource belongs.
    If it is not provided, the provider project is used.

* `desired_psc_auto_connections` - (Optional) Required. Immutable. User inputs for the auto-created PSC connections. 

<a name="nested_persistence_config"></a>The `persistence_config` block supports:

* `mode` -
  (Optional)
  Optional. Current persistence mode. 
   Possible values:
  DISABLED
  RDB
  AOF
  Possible values are: `DISABLED`, `RDB`, `AOF`.

* `rdb_config` -
  (Optional)
  Configuration for RDB based persistence.
  Structure is [documented below](#nested_persistence_config_rdb_config).

* `aof_config` -
  (Optional)
  Configuration for AOF based persistence.
  Structure is [documented below](#nested_persistence_config_aof_config).


<a name="nested_persistence_config_rdb_config"></a>The `rdb_config` block supports:

* `rdb_snapshot_period` -
  (Optional)
  Optional. Period between RDB snapshots. 
   Possible values:
   ONE_HOUR
  SIX_HOURS
  TWELVE_HOURS
  TWENTY_FOUR_HOURS

* `rdb_snapshot_start_time` -
  (Optional)
  Optional. Time that the first snapshot was/will be attempted, and to which future
  snapshots will be aligned. If not provided, the current time will be
  used.

<a name="nested_persistence_config_aof_config"></a>The `aof_config` block supports:

* `append_fsync` -
  (Optional)
  Optional. The fsync mode. 
   Possible values:
   NEVER
  EVERY_SEC
  ALWAYS

<a name="nested_zone_distribution_config"></a>The `zone_distribution_config` block supports:

* `zone` -
  (Optional)
  Optional. Defines zone where all resources will be allocated with SINGLE_ZONE mode.
  Ignored for MULTI_ZONE mode.

* `mode` -
  (Optional)
  Optional. Current zone distribution mode. Defaults to MULTI_ZONE. 
   Possible values:
   MULTI_ZONE
  SINGLE_ZONE
  Possible values are: `MULTI_ZONE`, `SINGLE_ZONE`.

## Attributes Reference

In addition to the arguments listed above, the following computed attributes are exported:

* `id` - an identifier for the resource with format `projects/{{project}}/locations/{{location}}/instances/{{instance_id}}`

* `name` -
  Identifier. Unique name of the instance.
  Format: projects/{project}/locations/{location}/instances/{instance}

* `create_time` -
  Output only. Creation timestamp of the instance.

* `update_time` -
  Output only. Latest update timestamp of the instance.

* `state` -
  Output only. Current state of the instance. 
   Possible values:
   CREATING
  ACTIVE
  UPDATING
  DELETING

* `state_info` -
  Additional information about the state of the instance.
  Structure is [documented below](#nested_state_info).

* `uid` -
  Output only. System assigned, unique identifier for the instance.

* `discovery_endpoints` -
  Output only. Endpoints clients can connect to the instance through. Currently only one
  discovery endpoint is supported.
  Structure is [documented below](#nested_discovery_endpoints).

* `node_config` -
  Represents configuration for nodes of the instance.
  Structure is [documented below](#nested_node_config).

* `endpoints` -
  Endpoints for the instance.
  Structure is [documented below](#nested_endpoints).

* `psc_auto_connections` -
  Output only. User inputs and resource details of the auto-created PSC connections.
  Structure is [documented below](#nested_psc_auto_connections).

* `terraform_labels` -
  The combination of labels configured directly on the resource
   and default labels configured on the provider.

* `effective_labels` -
  All of labels (key/value pairs) present on the resource in GCP, including the labels configured through Terraform, other clients and services.


<a name="nested_state_info"></a>The `state_info` block contains:

* `update_info` -
  (Output)
  Represents information about instance with state UPDATING.
  Structure is [documented below](#nested_state_info_update_info).


<a name="nested_state_info_update_info"></a>The `update_info` block contains:

* `target_shard_count` -
  (Output)
  Output only. Target number of shards for the instance.

* `target_replica_count` -
  (Output)
  Output only. Target number of replica nodes per shard for the instance.

<a name="nested_discovery_endpoints"></a>The `discovery_endpoints` block contains:

* `address` -
  (Output)
  Output only. IP address of the exposed endpoint clients connect to.

* `port` -
  (Output)
  Output only. The port number of the exposed endpoint.

* `network` -
  (Output)
  Output only. The network where the IP address of the discovery endpoint will be
  reserved, in the form of
  projects/{network_project}/global/networks/{network_id}.

<a name="nested_node_config"></a>The `node_config` block contains:

* `size_gb` -
  (Output)
  Output only. Memory size in GB of the node.

<a name="nested_endpoints"></a>The `endpoints` block contains:

* `connections` -
  (Optional)
  A group of PSC connections. They are created in the same VPC network, one for each service attachment in the cluster.
  Structure is [documented below](#nested_endpoints_endpoints_connections).


<a name="nested_endpoints_endpoints_connections"></a>The `connections` block supports:

* `psc_auto_connection` -
  (Optional)
  Detailed information of a PSC connection that is created through service connectivity automation.
  Structure is [documented below](#nested_endpoints_endpoints_connections_connections_psc_auto_connection).


<a name="nested_endpoints_endpoints_connections_connections_psc_auto_connection"></a>The `psc_auto_connection` block supports:

* `psc_connection_id` -
  (Output)
  Output only. The PSC connection id of the forwarding rule connected to the
  service attachment.

* `ip_address` -
  (Output)
  Output only. The IP allocated on the consumer network for the PSC forwarding rule.

* `forwarding_rule` -
  (Output)
  Output only. The URI of the consumer side forwarding rule.
  Format:
  projects/{project}/regions/{region}/forwardingRules/{forwarding_rule}

* `project_id` -
  (Output)
  Output only. The consumer project_id where the forwarding rule is created from.

* `network` -
  (Output)
  Output only. The consumer network where the IP address resides, in the form of
  projects/{project_id}/global/networks/{network_id}.

* `service_attachment` -
  (Output)
  Output only. The service attachment which is the target of the PSC connection, in the form of projects/{project-id}/regions/{region}/serviceAttachments/{service-attachment-id}.

* `connection_type` -
  (Output)
  Output Only. Type of a PSC Connection. 
   Possible values:
   CONNECTION_TYPE_DISCOVERY 
   CONNECTION_TYPE_PRIMARY 
   CONNECTION_TYPE_READER

* `port` -
  (Output)
  Output only. Ports of the exposed endpoint.

<a name="nested_psc_auto_connections"></a>The `psc_auto_connections` block contains:

* `psc_connection_id` -
  (Output)
  Output only. The PSC connection id of the forwarding rule connected to the
  service attachment.

* `ip_address` -
  (Output)
  Output only. The IP allocated on the consumer network for the PSC forwarding rule.

* `forwarding_rule` -
  (Output)
  Output only. The URI of the consumer side forwarding rule.
  Format:
  projects/{project}/regions/{region}/forwardingRules/{forwarding_rule}

* `project_id` -
  (Output)
  Output only. The consumer project_id where the forwarding rule is created from.

* `network` -
  (Output)
  Output only. The consumer network where the IP address resides, in the form of
  projects/{project_id}/global/networks/{network_id}.

* `service_attachment` -
  (Output)
  Output only. The service attachment which is the target of the PSC connection, in the form of projects/{project-id}/regions/{region}/serviceAttachments/{service-attachment-id}.

* `psc_connection_status` -
  (Output)
  Output Only. The status of the PSC connection: whether a connection exists and ACTIVE or it no longer exists. 
   Possible values:
   ACTIVE 
   NOT_FOUND

* `connection_type` -
  (Output)
  Output Only. Type of a PSC Connection. 
   Possible values:
   CONNECTION_TYPE_DISCOVERY 
   CONNECTION_TYPE_PRIMARY 
   CONNECTION_TYPE_READER

* `port` -
  (Output)
  Output only. Ports of the exposed endpoint.

## Timeouts

This resource provides the following
[Timeouts](https://developer.hashicorp.com/terraform/plugin/sdkv2/resources/retries-and-customizable-timeouts) configuration options:

- `create` - Default is 60 minutes.
- `update` - Default is 120 minutes.
- `delete` - Default is 30 minutes.

## Import


Instance can be imported using any of these accepted formats:

* `projects/{{project}}/locations/{{location}}/instances/{{instance_id}}`
* `{{project}}/{{location}}/{{instance_id}}`
* `{{location}}/{{instance_id}}`


In Terraform v1.5.0 and later, use an [`import` block](https://developer.hashicorp.com/terraform/language/import) to import Instance using one of the formats above. For example:

```tf
import {
  id = "projects/{{project}}/locations/{{location}}/instances/{{instance_id}}"
  to = google_memorystore_instance.default
}
```

When using the [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import), Instance can be imported using one of the formats above. For example:

```
$ terraform import google_memorystore_instance.default projects/{{project}}/locations/{{location}}/instances/{{instance_id}}
$ terraform import google_memorystore_instance.default {{project}}/{{location}}/{{instance_id}}
$ terraform import google_memorystore_instance.default {{location}}/{{instance_id}}
```

## User Project Overrides

This resource supports [User Project Overrides](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference#user_project_override).

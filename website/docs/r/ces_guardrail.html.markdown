---
# ----------------------------------------------------------------------------
#
#     ***     AUTO GENERATED CODE    ***    Type: MMv1     ***
#
# ----------------------------------------------------------------------------
#
#     This code is generated by Magic Modules using the following:
#
#     Configuration: https:#github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/products/ces/Guardrail.yaml
#     Template:      https:#github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/templates/terraform/resource.html.markdown.tmpl
#
#     DO NOT EDIT this file directly. Any changes made to this file will be
#     overwritten during the next generation cycle.
#
# ----------------------------------------------------------------------------
subcategory: "Customer Engagement Suite"
description: |-
  Description
---

# google_ces_guardrail

Description



<div class = "oics-button" style="float: right; margin: 0 0 -15px">
  <a href="https://console.cloud.google.com/cloudshell/open?cloudshell_git_repo=https%3A%2F%2Fgithub.com%2Fterraform-google-modules%2Fdocs-examples.git&cloudshell_image=gcr.io%2Fcloudshell-images%2Fcloudshell%3Alatest&cloudshell_print=.%2Fmotd&cloudshell_tutorial=.%2Ftutorial.md&cloudshell_working_dir=ces_guardrail_basic&open_in_editor=main.tf" target="_blank">
    <img alt="Open in Cloud Shell" src="//gstatic.com/cloudssh/images/open-btn.svg" style="max-height: 44px; margin: 32px auto; max-width: 100%;">
  </a>
</div>
## Example Usage - Ces Guardrail Basic


```hcl
resource "google_ces_app" "ces_app_for_guardrail" {
  app_id = "app-id"
  location = "us"
  description = "App used as parent for CES Toolset example"
  display_name = "my-app"

  language_settings {
    default_language_code    = "en-US"
    supported_language_codes = ["es-ES", "fr-FR"]
    enable_multilingual_support = true
    fallback_action          = "escalate"
  }
  time_zone_settings {
    time_zone = "America/Los_Angeles"
  }
}

resource "google_ces_guardrail" "ces_guardrail_basic" {
  guardrail_id = "guardrail-id"
  location     = google_ces_app.ces_app_for_guardrail.location
  app          = google_ces_app.ces_app_for_guardrail.app_id
  display_name = "my-guardrail"
  description  = "Guardrail description"
  action {
    respond_immediately  {
        responses {
            text = "Text"
            disabled = false
        }
    }
  }
  enabled = true
  model_safety  {
    safety_settings {
        category = "HARM_CATEGORY_HATE_SPEECH"
        threshold = "BLOCK_NONE"
    }
  }
}
```
<div class = "oics-button" style="float: right; margin: 0 0 -15px">
  <a href="https://console.cloud.google.com/cloudshell/open?cloudshell_git_repo=https%3A%2F%2Fgithub.com%2Fterraform-google-modules%2Fdocs-examples.git&cloudshell_image=gcr.io%2Fcloudshell-images%2Fcloudshell%3Alatest&cloudshell_print=.%2Fmotd&cloudshell_tutorial=.%2Ftutorial.md&cloudshell_working_dir=ces_guardrail_transfer_agent_content_filter&open_in_editor=main.tf" target="_blank">
    <img alt="Open in Cloud Shell" src="//gstatic.com/cloudssh/images/open-btn.svg" style="max-height: 44px; margin: 32px auto; max-width: 100%;">
  </a>
</div>
## Example Usage - Ces Guardrail Transfer Agent Content Filter


```hcl
resource "google_ces_app" "ces_app_for_guardrail" {
  app_id = "app-id"
  location = "us"
  description = "App used as parent for CES Toolset example"
  display_name = "my-app"

  language_settings {
    default_language_code    = "en-US"
    supported_language_codes = ["es-ES", "fr-FR"]
    enable_multilingual_support = true
    fallback_action          = "escalate"
  }
  time_zone_settings {
    time_zone = "America/Los_Angeles"
  }
}

resource "google_ces_guardrail" "ces_guardrail_transfer_agent_content_filter" {
  guardrail_id = "guardrail-id"
  location     = google_ces_app.ces_app_for_guardrail.location
  app          = google_ces_app.ces_app_for_guardrail.app_id
  display_name = "my-guardrail"
  description  = "Guardrail description"
  action {
    transfer_agent {
        agent = "projects/${google_ces_app.ces_app_for_guardrail.project}/locations/us/apps/${google_ces_app.ces_app_for_guardrail.app_id}/agents/fake-agent"
    }
  }
  enabled = true
  content_filter {
    banned_contents = ["example"]
    banned_contents_in_user_input = ["example"]
    banned_contents_in_agent_response = ["example"]
    match_type = "SIMPLE_STRING_MATCH"
    disregard_diacritics = true
  }
}
```
<div class = "oics-button" style="float: right; margin: 0 0 -15px">
  <a href="https://console.cloud.google.com/cloudshell/open?cloudshell_git_repo=https%3A%2F%2Fgithub.com%2Fterraform-google-modules%2Fdocs-examples.git&cloudshell_image=gcr.io%2Fcloudshell-images%2Fcloudshell%3Alatest&cloudshell_print=.%2Fmotd&cloudshell_tutorial=.%2Ftutorial.md&cloudshell_working_dir=ces_guardrail_generative_answer_llm_prompt_security&open_in_editor=main.tf" target="_blank">
    <img alt="Open in Cloud Shell" src="//gstatic.com/cloudssh/images/open-btn.svg" style="max-height: 44px; margin: 32px auto; max-width: 100%;">
  </a>
</div>
## Example Usage - Ces Guardrail Generative Answer Llm Prompt Security


```hcl
resource "google_ces_app" "ces_app_for_guardrail" {
  app_id = "app-id"
  location = "us"
  description = "App used as parent for CES Toolset example"
  display_name = "my-app"

  language_settings {
    default_language_code    = "en-US"
    supported_language_codes = ["es-ES", "fr-FR"]
    enable_multilingual_support = true
    fallback_action          = "escalate"
  }
  time_zone_settings {
    time_zone = "America/Los_Angeles"
  }
}

resource "google_ces_guardrail" "ces_guardrail_generative_answer_llm_prompt_security" {
  guardrail_id = "guardrail-id"
  location     = google_ces_app.ces_app_for_guardrail.location
  app          = google_ces_app.ces_app_for_guardrail.app_id
  display_name = "my-guardrail"
  description  = "Guardrail description"
  action {
    generative_answer {
        prompt = "example_prompt"
    }
  }
  enabled = true
  llm_prompt_security {
    custom_policy {
      max_conversation_messages = 10
      model_settings {
        model = "gemini-2.5-flash"
        temperature = 50
      }
      prompt = "example_prompt"
      policy_scope = "USER_QUERY"
      fail_open = true
      allow_short_utterance = true
    }
  }
}
```
<div class = "oics-button" style="float: right; margin: 0 0 -15px">
  <a href="https://console.cloud.google.com/cloudshell/open?cloudshell_git_repo=https%3A%2F%2Fgithub.com%2Fterraform-google-modules%2Fdocs-examples.git&cloudshell_image=gcr.io%2Fcloudshell-images%2Fcloudshell%3Alatest&cloudshell_print=.%2Fmotd&cloudshell_tutorial=.%2Ftutorial.md&cloudshell_working_dir=ces_guardrail_code_callback&open_in_editor=main.tf" target="_blank">
    <img alt="Open in Cloud Shell" src="//gstatic.com/cloudssh/images/open-btn.svg" style="max-height: 44px; margin: 32px auto; max-width: 100%;">
  </a>
</div>
## Example Usage - Ces Guardrail Code Callback


```hcl
resource "google_ces_app" "ces_app_for_guardrail" {
  app_id = "app-id"
  location = "us"
  description = "App used as parent for CES Toolset example"
  display_name = "my-app"

  language_settings {
    default_language_code    = "en-US"
    supported_language_codes = ["es-ES", "fr-FR"]
    enable_multilingual_support = true
    fallback_action          = "escalate"
  }
  time_zone_settings {
    time_zone = "America/Los_Angeles"
  }
}

resource "google_ces_guardrail" "ces_guardrail_code_callback" {
  guardrail_id = "guardrail-id"
  location     = google_ces_app.ces_app_for_guardrail.location
  app          = google_ces_app.ces_app_for_guardrail.app_id
  display_name = "my-guardrail"
  description  = "Guardrail description"
  action {
    generative_answer {
        prompt = "example_prompt"
    }
  }
  enabled = true
  code_callback {
    before_agent_callback {
        description = "Example callback"
        disabled    = true
        python_code = "def callback(context):\n    return {'override': False}"
    }
    after_agent_callback {
        description = "Example callback"
        disabled    = true
        python_code = "def callback(context):\n    return {'override': False}"
    }
    before_model_callback {
        description = "Example callback"
        disabled    = true
        python_code = "def callback(context):\n    return {'override': False}"
    }
    after_model_callback {
        description = "Example callback"
        disabled    = true
        python_code = "def callback(context):\n    return {'override': False}"
    }
  }
}
```
<div class = "oics-button" style="float: right; margin: 0 0 -15px">
  <a href="https://console.cloud.google.com/cloudshell/open?cloudshell_git_repo=https%3A%2F%2Fgithub.com%2Fterraform-google-modules%2Fdocs-examples.git&cloudshell_image=gcr.io%2Fcloudshell-images%2Fcloudshell%3Alatest&cloudshell_print=.%2Fmotd&cloudshell_tutorial=.%2Ftutorial.md&cloudshell_working_dir=ces_guardrail_llm_policy&open_in_editor=main.tf" target="_blank">
    <img alt="Open in Cloud Shell" src="//gstatic.com/cloudssh/images/open-btn.svg" style="max-height: 44px; margin: 32px auto; max-width: 100%;">
  </a>
</div>
## Example Usage - Ces Guardrail Llm Policy


```hcl
resource "google_ces_app" "ces_app_for_guardrail" {
  app_id = "app-id"
  location = "us"
  description = "App used as parent for CES Toolset example"
  display_name = "my-app"

  language_settings {
    default_language_code    = "en-US"
    supported_language_codes = ["es-ES", "fr-FR"]
    enable_multilingual_support = true
    fallback_action          = "escalate"
  }
  time_zone_settings {
    time_zone = "America/Los_Angeles"
  }
}

resource "google_ces_guardrail" "ces_guardrail_llm_policy" {
  guardrail_id = "guardrail-id"
  location     = google_ces_app.ces_app_for_guardrail.location
  app          = google_ces_app.ces_app_for_guardrail.app_id
  display_name = "my-guardrail"
  description  = "Guardrail description"
  action {
    generative_answer {
        prompt = "example_prompt"
    }
  }
  enabled = true
  llm_policy {
    max_conversation_messages = 10
    model_settings {
        model = "gemini-2.5-flash"
        temperature = 50
    }
    prompt = "example_prompt"
    policy_scope = "USER_QUERY"
    fail_open = true
    allow_short_utterance = true
  }
}
```

## Argument Reference

The following arguments are supported:


* `display_name` -
  (Required)
  Display name of the guardrail.

* `location` -
  (Required)
  Resource ID segment making up resource `name`. It identifies the resource within its parent collection as described in https://google.aip.dev/122.

* `app` -
  (Required)
  Resource ID segment making up resource `name`. It identifies the resource within its parent collection as described in https://google.aip.dev/122.

* `guardrail_id` -
  (Required)
  The ID to use for the guardrail, which will become the final component of
  the guardrail's resource name. If not provided, a unique ID will be
  automatically assigned for the guardrail.


* `action` -
  (Optional)
  Action that is taken when a certain precondition is met.
  Structure is [documented below](#nested_action).

* `code_callback` -
  (Optional)
  Guardrail that blocks the conversation based on the code callbacks
  provided.
  Structure is [documented below](#nested_code_callback).

* `content_filter` -
  (Optional)
  Guardrail that bans certain content from being used in the conversation.
  Structure is [documented below](#nested_content_filter).

* `description` -
  (Optional)
  Description of the guardrail.

* `enabled` -
  (Optional)
  Whether the guardrail is enabled.

* `llm_policy` -
  (Optional)
  Guardrail that blocks the conversation if the LLM response is considered
  violating the policy based on the LLM classification.
  Structure is [documented below](#nested_llm_policy).

* `llm_prompt_security` -
  (Optional)
  Guardrail that blocks the conversation if the input is considered unsafe
  based on the LLM classification.
  Structure is [documented below](#nested_llm_prompt_security).

* `model_safety` -
  (Optional)
  Model safety settings overrides. When this is set, it will override the
  default settings and trigger the guardrail if the response is considered
  unsafe.
  Structure is [documented below](#nested_model_safety).

* `project` - (Optional) The ID of the project in which the resource belongs.
    If it is not provided, the provider project is used.



<a name="nested_action"></a>The `action` block supports:

* `generative_answer` -
  (Optional)
  The agent will immediately respond with a generative answer.
  Structure is [documented below](#nested_action_generative_answer).

* `respond_immediately` -
  (Optional)
  The agent will immediately respond with a preconfigured response.
  Structure is [documented below](#nested_action_respond_immediately).

* `transfer_agent` -
  (Optional)
  The agent will transfer the conversation to a different agent.
  Structure is [documented below](#nested_action_transfer_agent).


<a name="nested_action_generative_answer"></a>The `generative_answer` block supports:

* `prompt` -
  (Required)
  The prompt to use for the generative answer.

<a name="nested_action_respond_immediately"></a>The `respond_immediately` block supports:

* `responses` -
  (Required)
  The canned responses for the agent to choose from. The response is chosen
  randomly.
  Structure is [documented below](#nested_action_respond_immediately_responses).


<a name="nested_action_respond_immediately_responses"></a>The `responses` block supports:

* `disabled` -
  (Optional)
  Whether the response is disabled. Disabled responses are not used by the
  agent.

* `text` -
  (Required)
  Text for the agent to respond with.

<a name="nested_action_transfer_agent"></a>The `transfer_agent` block supports:

* `agent` -
  (Required)
  The name of the agent to transfer the conversation to. The agent must be
  in the same app as the current agent.
  Format:
  `projects/{project}/locations/{location}/apps/{app}/agents/{agent}`

<a name="nested_code_callback"></a>The `code_callback` block supports:

* `after_agent_callback` -
  (Optional)
  A callback defines the custom logic to be executed at various stages of
  agent interaction.
  Structure is [documented below](#nested_code_callback_after_agent_callback).

* `after_model_callback` -
  (Optional)
  A callback defines the custom logic to be executed at various stages of
  agent interaction.
  Structure is [documented below](#nested_code_callback_after_model_callback).

* `before_agent_callback` -
  (Optional)
  A callback defines the custom logic to be executed at various stages of
  agent interaction.
  Structure is [documented below](#nested_code_callback_before_agent_callback).

* `before_model_callback` -
  (Optional)
  A callback defines the custom logic to be executed at various stages of
  agent interaction.
  Structure is [documented below](#nested_code_callback_before_model_callback).


<a name="nested_code_callback_after_agent_callback"></a>The `after_agent_callback` block supports:

* `description` -
  (Optional)
  Human-readable description of the callback.

* `disabled` -
  (Optional)
  Whether the callback is disabled. Disabled callbacks are ignored by the
  agent.

* `python_code` -
  (Required)
  The python code to execute for the callback.

<a name="nested_code_callback_after_model_callback"></a>The `after_model_callback` block supports:

* `description` -
  (Optional)
  Human-readable description of the callback.

* `disabled` -
  (Optional)
  Whether the callback is disabled. Disabled callbacks are ignored by the
  agent.

* `python_code` -
  (Required)
  The python code to execute for the callback.

<a name="nested_code_callback_before_agent_callback"></a>The `before_agent_callback` block supports:

* `description` -
  (Optional)
  Human-readable description of the callback.

* `disabled` -
  (Optional)
  Whether the callback is disabled. Disabled callbacks are ignored by the
  agent.

* `python_code` -
  (Required)
  The python code to execute for the callback.

<a name="nested_code_callback_before_model_callback"></a>The `before_model_callback` block supports:

* `description` -
  (Optional)
  Human-readable description of the callback.

* `disabled` -
  (Optional)
  Whether the callback is disabled. Disabled callbacks are ignored by the
  agent.

* `python_code` -
  (Required)
  The python code to execute for the callback.

<a name="nested_content_filter"></a>The `content_filter` block supports:

* `banned_contents` -
  (Optional)
  List of banned phrases. Applies to both user inputs and agent responses.

* `banned_contents_in_agent_response` -
  (Optional)
  List of banned phrases. Applies only to agent responses.

* `banned_contents_in_user_input` -
  (Optional)
  List of banned phrases. Applies only to user inputs.

* `disregard_diacritics` -
  (Optional)
  If true, diacritics are ignored during matching.

* `match_type` -
  (Required)
  Match type for the content filter.
  Possible values:
  SIMPLE_STRING_MATCH
  WORD_BOUNDARY_STRING_MATCH
  REGEXP_MATCH

<a name="nested_llm_policy"></a>The `llm_policy` block supports:

* `fail_open` -
  (Optional)
  If an error occurs during the policy check, fail open and do not trigger
  the guardrail.

* `max_conversation_messages` -
  (Optional)
  When checking this policy, consider the last 'n' messages in the
  conversation.
  When not set a default value of 10 will be used.

* `model_settings` -
  (Optional)
  Model settings contains various configurations for the LLM model.
  Structure is [documented below](#nested_llm_policy_model_settings).

* `policy_scope` -
  (Required)
  Defines when to apply the policy check during the conversation. If set to
  `POLICY_SCOPE_UNSPECIFIED`, the policy will be applied to the user input.
  When applying the policy to the agent response, additional latency will
  be introduced before the agent can respond.
  Possible values:
  USER_QUERY
  AGENT_RESPONSE
  USER_QUERY_AND_AGENT_RESPONSE
  Possible values are: `USER_QUERY`, `AGENT_RESPONSE`, `USER_QUERY_AND_AGENT_RESPONSE`.

* `prompt` -
  (Required)
  Policy prompt.

* `allow_short_utterance` -
  (Optional)
  By default, the LLM policy check is bypassed for short utterances.
  Enabling this setting applies the policy check to all utterances,
  including those that would normally be skipped.


<a name="nested_llm_policy_model_settings"></a>The `model_settings` block supports:

* `model` -
  (Optional)
  The LLM model that the agent should use.
  If not set, the agent will inherit the model from its parent agent.

* `temperature` -
  (Optional)
  If set, this temperature will be used for the LLM model. Temperature
  controls the randomness of the model's responses. Lower temperatures
  produce responses that are more predictable. Higher temperatures produce
  responses that are more creative.

<a name="nested_llm_prompt_security"></a>The `llm_prompt_security` block supports:

* `custom_policy` -
  (Optional)
  Guardrail that blocks the conversation if the LLM response is considered
  violating the policy based on the LLM classification.
  Structure is [documented below](#nested_llm_prompt_security_custom_policy).

* `default_settings` -
  (Optional)
  Configuration for default system security settings.
  Structure is [documented below](#nested_llm_prompt_security_default_settings).


<a name="nested_llm_prompt_security_custom_policy"></a>The `custom_policy` block supports:

* `fail_open` -
  (Optional)
  If an error occurs during the policy check, fail open and do not trigger
  the guardrail.

* `max_conversation_messages` -
  (Optional)
  When checking this policy, consider the last 'n' messages in the
  conversation.
  When not set a default value of 10 will be used.

* `model_settings` -
  (Optional)
  Model settings contains various configurations for the LLM model.
  Structure is [documented below](#nested_llm_prompt_security_custom_policy_model_settings).

* `policy_scope` -
  (Required)
  Defines when to apply the policy check during the conversation. If set to
  `POLICY_SCOPE_UNSPECIFIED`, the policy will be applied to the user input.
  When applying the policy to the agent response, additional latency will
  be introduced before the agent can respond.
  Possible values:
  USER_QUERY
  AGENT_RESPONSE
  USER_QUERY_AND_AGENT_RESPONSE

* `prompt` -
  (Required)
  Policy prompt.

* `allow_short_utterance` -
  (Optional)
  By default, the LLM policy check is bypassed for short utterances.
  Enabling this setting applies the policy check to all utterances,
  including those that would normally be skipped.


<a name="nested_llm_prompt_security_custom_policy_model_settings"></a>The `model_settings` block supports:

* `model` -
  (Optional)
  The LLM model that the agent should use.
  If not set, the agent will inherit the model from its parent agent.

* `temperature` -
  (Optional)
  If set, this temperature will be used for the LLM model. Temperature
  controls the randomness of the model's responses. Lower temperatures
  produce responses that are more predictable. Higher temperatures produce
  responses that are more creative.

<a name="nested_llm_prompt_security_default_settings"></a>The `default_settings` block supports:

* `default_prompt_template` -
  (Output)
  The default prompt template used by the system.
  This field is for display purposes to show the user what prompt
  the system uses by default. It is OUTPUT_ONLY.

<a name="nested_model_safety"></a>The `model_safety` block supports:

* `safety_settings` -
  (Required)
  List of safety settings.
  Structure is [documented below](#nested_model_safety_safety_settings).


<a name="nested_model_safety_safety_settings"></a>The `safety_settings` block supports:

* `category` -
  (Required)
  The harm category.
  Possible values:
  HARM_CATEGORY_HATE_SPEECH
  HARM_CATEGORY_DANGEROUS_CONTENT
  HARM_CATEGORY_HARASSMENT
  HARM_CATEGORY_SEXUALLY_EXPLICIT
  Possible values are: `HARM_CATEGORY_HATE_SPEECH`, `HARM_CATEGORY_DANGEROUS_CONTENT`, `HARM_CATEGORY_HARASSMENT`, `HARM_CATEGORY_SEXUALLY_EXPLICIT`.

* `threshold` -
  (Required)
  The harm block threshold.
  Possible values:
  BLOCK_LOW_AND_ABOVE
  BLOCK_MEDIUM_AND_ABOVE
  BLOCK_ONLY_HIGH
  BLOCK_NONE
  OFF
  Possible values are: `BLOCK_LOW_AND_ABOVE`, `BLOCK_MEDIUM_AND_ABOVE`, `BLOCK_ONLY_HIGH`, `BLOCK_NONE`, `OFF`.

## Attributes Reference

In addition to the arguments listed above, the following computed attributes are exported:

* `id` - an identifier for the resource with format `projects/{{project}}/locations/{{location}}/apps/{{app}}/guardrails/{{name}}`

* `create_time` -
  Timestamp when the guardrail was created.

* `etag` -
  Etag used to ensure the object hasn't changed during a read-modify-write
  operation. If the etag is empty, the update will overwrite any concurrent
  changes.

* `name` -
  Identifier. The unique identifier of the guardrail.
  Format:
  `projects/{project}/locations/{location}/apps/{app}/guardrails/{guardrail}`

* `update_time` -
  Timestamp when the guardrail was last updated.


## Timeouts

This resource provides the following
[Timeouts](https://developer.hashicorp.com/terraform/plugin/sdkv2/resources/retries-and-customizable-timeouts) configuration options:

- `create` - Default is 20 minutes.
- `update` - Default is 20 minutes.
- `delete` - Default is 20 minutes.

## Import


Guardrail can be imported using any of these accepted formats:

* `projects/{{project}}/locations/{{location}}/apps/{{app}}/guardrails/{{name}}`
* `{{project}}/{{location}}/{{app}}/{{name}}`
* `{{location}}/{{app}}/{{name}}`


In Terraform v1.5.0 and later, use an [`import` block](https://developer.hashicorp.com/terraform/language/import) to import Guardrail using one of the formats above. For example:

```tf
import {
  id = "projects/{{project}}/locations/{{location}}/apps/{{app}}/guardrails/{{name}}"
  to = google_ces_guardrail.default
}
```

When using the [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import), Guardrail can be imported using one of the formats above. For example:

```
$ terraform import google_ces_guardrail.default projects/{{project}}/locations/{{location}}/apps/{{app}}/guardrails/{{name}}
$ terraform import google_ces_guardrail.default {{project}}/{{location}}/{{app}}/{{name}}
$ terraform import google_ces_guardrail.default {{location}}/{{app}}/{{name}}
```

## User Project Overrides

This resource supports [User Project Overrides](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference#user_project_override).

---
# ----------------------------------------------------------------------------
#
#     ***     AUTO GENERATED CODE    ***    Type: MMv1     ***
#
# ----------------------------------------------------------------------------
#
#     This file is automatically generated by Magic Modules and manual
#     changes will be clobbered when the file is regenerated.
#
#     Please read more about how to change this file in
#     .github/CONTRIBUTING.md.
#
# ----------------------------------------------------------------------------
subcategory: "Identity-Aware Proxy"
description: |-
  IAP settings - manage IAP settings
---

# google_iap_settings

IAP settings - manage IAP settings


To get more information about Settings, see:

* [API documentation](https://cloud.google.com/iap/docs/reference/rest/v1/IapSettings)
* How-to Guides
    * [Customizing IAP](https://cloud.google.com/iap/docs/customizing)

~> **Warning:** All arguments including the following potentially sensitive
values will be stored in the raw state as plain text: `access_settings.workforce_identity_settings.oauth2.client_secret`.
[Read more about sensitive data in state](https://www.terraform.io/language/state/sensitive-data).

<div class = "oics-button" style="float: right; margin: 0 0 -15px">
  <a href="https://console.cloud.google.com/cloudshell/open?cloudshell_git_repo=https%3A%2F%2Fgithub.com%2Fterraform-google-modules%2Fdocs-examples.git&cloudshell_image=gcr.io%2Fcloudshell-images%2Fcloudshell%3Alatest&cloudshell_print=.%2Fmotd&cloudshell_tutorial=.%2Ftutorial.md&cloudshell_working_dir=iap_settings_basic&open_in_editor=main.tf" target="_blank">
    <img alt="Open in Cloud Shell" src="//gstatic.com/cloudssh/images/open-btn.svg" style="max-height: 44px; margin: 32px auto; max-width: 100%;">
  </a>
</div>
## Example Usage - Iap Settings Basic


```hcl
data "google_project" "project" {
}

resource "google_compute_region_backend_service" "default" {
  name                            = "iap-settings-tf"
  region                          = "us-central1"
  health_checks                   = [google_compute_health_check.default.id]
  connection_draining_timeout_sec = 10
  session_affinity                = "CLIENT_IP"
}

resource "google_compute_health_check" "default" {
  name               = "iap-bs-health-check"
  check_interval_sec = 1
  timeout_sec        = 1

  tcp_health_check {
    port = "80"
  }
}

resource "google_iap_settings" "iap_settings" {
  name = "projects/${data.google_project.project.number}/iap_web/compute-us-central1/services/${google_compute_region_backend_service.default.name}"
  access_settings {
    identity_sources = ["WORKFORCE_IDENTITY_FEDERATION"]
    allowed_domains_settings {
      domains = ["test.abc.com"]
      enable  = true
    }
    cors_settings {
      allow_http_options = true
    }
    reauth_settings {
      method = "SECURE_KEY"
      max_age = "305s"
      policy_type = "MINIMUM"
    }
    gcip_settings {
      login_page_uri = "https://test.com/?apiKey=abc"
    }
    oauth_settings {
      login_hint = "test"
    }
    workforce_identity_settings {
      workforce_pools = ["wif-pool"]
      oauth2 {
        client_id = "test-client-id"
        client_secret = "test-client-secret"
      }
    }    
  }
  application_settings {
    cookie_domain = "test.abc.com"
    csm_settings {
      rctoken_aud = "test-aud-set"
    }
    access_denied_page_settings {
      access_denied_page_uri = "test-uri"
      generate_troubleshooting_uri = true
      remediation_token_generation_enabled = false
    }
    attribute_propagation_settings {
      output_credentials = ["HEADER"]
      expression = "attributes.saml_attributes.filter(attribute, attribute.name in [\"test1\", \"test2\"])"
      enable = false
    }
  }
}
```

## Argument Reference

The following arguments are supported:


* `name` -
  (Required)
  The resource name of the IAP protected resource. Name can have below resources:
  * organizations/{organization_id}
  * folders/{folder_id}
  * projects/{projects_id}
  * projects/{projects_id}/iap_web
  * projects/{projects_id}/iap_web/compute
  * projects/{projects_id}/iap_web/compute-{region}
  * projects/{projects_id}/iap_web/compute/service/{service_id}
  * projects/{projects_id}/iap_web/compute-{region}/service/{service_id}
  * projects/{projects_id}/iap_web/appengine-{app_id}
  * projects/{projects_id}/iap_web/appengine-{app_id}/service/{service_id}
  * projects/{projects_id}/iap_web/appengine-{app_id}/service/{service_id}/version/{version_id}


- - -


* `access_settings` -
  (Optional)
  Top level wrapper for all access related setting in IAP.
  Structure is [documented below](#nested_access_settings).

* `application_settings` -
  (Optional)
  Top level wrapper for all application related settings in IAP.
  Structure is [documented below](#nested_application_settings).


<a name="nested_access_settings"></a>The `access_settings` block supports:

* `gcip_settings` -
  (Optional)
  GCIP claims and endpoint configurations for 3p identity providers.
  Structure is [documented below](#nested_gcip_settings).

* `cors_settings` -
  (Optional)
  Configuration to allow cross-origin requests via IAP.
  Structure is [documented below](#nested_cors_settings).

* `oauth_settings` -
  (Optional)
  Settings to configure IAP's OAuth behavior.
  Structure is [documented below](#nested_oauth_settings).

* `reauth_settings` -
  (Optional)
  Settings to configure reauthentication policies in IAP.
  Structure is [documented below](#nested_reauth_settings).

* `allowed_domains_settings` -
  (Optional)
  Settings to configure and enable allowed domains.
  Structure is [documented below](#nested_allowed_domains_settings).

* `workforce_identity_settings` -
  (Optional)
  Settings to configure the workforce identity federation, including workforce pools
  and OAuth 2.0 settings.
  Structure is [documented below](#nested_workforce_identity_settings).

* `identity_sources` -
  (Optional)
  Identity sources that IAP can use to authenticate the end user. Only one identity source
  can be configured. The possible values are:
  * `WORKFORCE_IDENTITY_FEDERATION`: Use external identities set up on Google Cloud Workforce
    				     Identity Federation.
  Each value may be one of: `WORKFORCE_IDENTITY_FEDERATION`.


<a name="nested_gcip_settings"></a>The `gcip_settings` block supports:

* `tenant_ids` -
  (Optional)
  GCIP tenant ids that are linked to the IAP resource. tenantIds could be a string
  beginning with a number character to indicate authenticating with GCIP tenant flow,
  or in the format of _ to indicate authenticating with GCIP agent flow. If agent flow
  is used, tenantIds should only contain one single element, while for tenant flow,
  tenantIds can contain multiple elements.

* `login_page_uri` -
  (Optional)
  Login page URI associated with the GCIP tenants. Typically, all resources within
  the same project share the same login page, though it could be overridden at the
  sub resource level.

<a name="nested_cors_settings"></a>The `cors_settings` block supports:

* `allow_http_options` -
  (Optional)
  Configuration to allow HTTP OPTIONS calls to skip authorization.
  If undefined, IAP will not apply any special logic to OPTIONS requests.

<a name="nested_oauth_settings"></a>The `oauth_settings` block supports:

* `login_hint` -
  (Optional)
  Domain hint to send as hd=? parameter in OAuth request flow.
  Enables redirect to primary IDP by skipping Google's login screen.
  (https://developers.google.com/identity/protocols/OpenIDConnect#hd-param)
  Note: IAP does not verify that the id token's hd claim matches this value
  since access behavior is managed by IAM policies.

* `programmatic_clients` -
  (Optional)
  List of client ids allowed to use IAP programmatically.

<a name="nested_reauth_settings"></a>The `reauth_settings` block supports:

* `method` -
  (Required)
  Reauth method requested. The possible values are:
  * `LOGIN`: Prompts the user to log in again.
  * `SECURE_KEY`: User must use their secure key 2nd factor device.
  * `ENROLLED_SECOND_FACTORS`: User can use any enabled 2nd factor.
  Possible values are: `LOGIN`, `SECURE_KEY`, `ENROLLED_SECOND_FACTORS`.

* `max_age` -
  (Required)
  Reauth session lifetime, how long before a user has to reauthenticate again.
  A duration in seconds with up to nine fractional digits, ending with 's'.
  Example: "3.5s".

* `policy_type` -
  (Required)
  How IAP determines the effective policy in cases of hierarchical policies.
  Policies are merged from higher in the hierarchy to lower in the hierarchy.
  The possible values are:
  * `MINIMUM`: This policy acts as a minimum to other policies, lower in the hierarchy.
  		   Effective policy may only be the same or stricter.
  * `DEFAULT`: This policy acts as a default if no other reauth policy is set.
  Possible values are: `MINIMUM`, `DEFAULT`.

<a name="nested_allowed_domains_settings"></a>The `allowed_domains_settings` block supports:

* `domains` -
  (Optional)
  List of trusted domains.

* `enable` -
  (Optional)
  Configuration for customers to opt in for the feature.

<a name="nested_workforce_identity_settings"></a>The `workforce_identity_settings` block supports:

* `workforce_pools` -
  (Optional)
  The workforce pool resources. Only one workforce pool is accepted.

* `oauth2` -
  (Optional)
  OAuth 2.0 settings for IAP to perform OIDC flow with workforce identity
  federation services.
  Structure is [documented below](#nested_oauth2).


<a name="nested_oauth2"></a>The `oauth2` block supports:

* `client_id` -
  (Optional)
  The OAuth 2.0 client ID registered in the workforce identity
  federation OAuth 2.0 Server.

* `client_secret` -
  (Optional)
  Input only. The OAuth 2.0 client secret created while registering
  the client ID.
  **Note**: This property is sensitive and will not be displayed in the plan.

* `client_secret_sha256` -
  (Output)
  Output only. SHA256 hash value for the client secret. This field
  is returned by IAP when the settings are retrieved.

<a name="nested_application_settings"></a>The `application_settings` block supports:

* `csm_settings` -
  (Optional)
  Settings to configure IAP's behavior for a service mesh.
  Structure is [documented below](#nested_csm_settings).

* `access_denied_page_settings` -
  (Optional)
  Customization for Access Denied page. IAP allows customers to define a custom URI
  to use as the error page when access is denied to users. If IAP prevents access
  to this page, the default IAP error page will be displayed instead.
  Structure is [documented below](#nested_access_denied_page_settings).

* `cookie_domain` -
  (Optional)
  The Domain value to set for cookies generated by IAP. This value is not validated by the API,
  but will be ignored at runtime if invalid.

* `attribute_propagation_settings` -
  (Optional)
  Settings to configure attribute propagation.
  Structure is [documented below](#nested_attribute_propagation_settings).


<a name="nested_csm_settings"></a>The `csm_settings` block supports:

* `rctoken_aud` -
  (Optional)
  Audience claim set in the generated RCToken. This value is not validated by IAP.

<a name="nested_access_denied_page_settings"></a>The `access_denied_page_settings` block supports:

* `access_denied_page_uri` -
  (Optional)
  The URI to be redirected to when access is denied.

* `generate_troubleshooting_uri` -
  (Optional)
  Whether to generate a troubleshooting URL on access denied events to this application.

* `remediation_token_generation_enabled` -
  (Optional)
  Whether to generate remediation token on access denied events to this application.

<a name="nested_attribute_propagation_settings"></a>The `attribute_propagation_settings` block supports:

* `output_credentials` -
  (Optional)
  Which output credentials attributes selected by the CEL expression should be propagated in.
  All attributes will be fully duplicated in each selected output credential.
  Possible values are:
  * `HEADER`: Propagate attributes in the headers with "x-goog-iap-attr-" prefix.
  * `JWT`: Propagate attributes in the JWT of the form:
           "additional_claims": { "my_attribute": ["value1", "value2"] }
  * `RCTOKEN`: Propagate attributes in the RCToken of the form: "
               additional_claims": { "my_attribute": ["value1", "value2"] }
  Each value may be one of: `HEADER`, `JWT`, `RCTOKEN`.

* `expression` -
  (Optional)
  Raw string CEL expression. Must return a list of attributes. A maximum of 45 attributes can
  be selected. Expressions can select different attribute types from attributes:
  attributes.saml_attributes, attributes.iap_attributes.

* `enable` -
  (Optional)
  Whether the provided attribute propagation settings should be evaluated on user requests.
  If set to true, attributes returned from the expression will be propagated in the set output credentials.

## Attributes Reference

In addition to the arguments listed above, the following computed attributes are exported:

* `id` - an identifier for the resource with format `{{name}}/iapSettings`


## Timeouts

This resource provides the following
[Timeouts](https://developer.hashicorp.com/terraform/plugin/sdkv2/resources/retries-and-customizable-timeouts) configuration options:

- `create` - Default is 20 minutes.
- `update` - Default is 20 minutes.
- `delete` - Default is 20 minutes.

## Import


Settings can be imported using any of these accepted formats:

* `{{name}}/iapSettings`
* `{{name}}`


In Terraform v1.5.0 and later, use an [`import` block](https://developer.hashicorp.com/terraform/language/import) to import Settings using one of the formats above. For example:

```tf
import {
  id = "{{name}}/iapSettings"
  to = google_iap_settings.default
}
```

When using the [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import), Settings can be imported using one of the formats above. For example:

```
$ terraform import google_iap_settings.default {{name}}/iapSettings
$ terraform import google_iap_settings.default {{name}}
```

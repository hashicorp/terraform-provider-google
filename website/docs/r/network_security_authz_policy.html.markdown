---
# ----------------------------------------------------------------------------
#
#     ***     AUTO GENERATED CODE    ***    Type: MMv1     ***
#
# ----------------------------------------------------------------------------
#
#     This code is generated by Magic Modules using the following:
#
#     Configuration: https:#github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/products/networksecurity/AuthzPolicy.yaml
#     Template:      https:#github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/templates/terraform/resource.html.markdown.tmpl
#
#     DO NOT EDIT this file directly. Any changes made to this file will be
#     overwritten during the next generation cycle.
#
# ----------------------------------------------------------------------------
subcategory: "Network Security"
description: |-
  AuthzPolicy is a resource that allows to forward traffic to a callout backend designed to scan the traffic for security purposes.
---

# google_network_security_authz_policy

AuthzPolicy is a resource that allows to forward traffic to a callout backend designed to scan the traffic for security purposes.


To get more information about AuthzPolicy, see:

* [API documentation](https://cloud.google.com/load-balancing/docs/reference/network-security/rest/v1beta1/projects.locations.authzPolicies)

## Example Usage - Network Security Authz Policy Advanced


```hcl
resource "google_compute_network" "default" {
  name                    = "lb-network"
  project                 = "my-project-name"
  auto_create_subnetworks = false
}

resource "google_compute_subnetwork" "default" {
  name          = "backend-subnet"
  project       = "my-project-name"
  region        = "us-west1"
  ip_cidr_range = "10.1.2.0/24"
  network       = google_compute_network.default.id
}

resource "google_compute_subnetwork" "proxy_only" {
  name          = "proxy-only-subnet"
  project       = "my-project-name"
  region        = "us-west1"
  ip_cidr_range = "10.129.0.0/23"
  purpose       = "REGIONAL_MANAGED_PROXY"
  role          = "ACTIVE"
  network       = google_compute_network.default.id
}

resource "google_compute_instance" "callouts_instance" {
  name                = "l7-ilb-callouts-ins"
  zone                = "us-west1-a"
  machine_type        = "e2-small"
  tags                = ["allow-ssh","load-balanced-backend"]
  deletion_protection = false

  labels = {
    "container-vm" = "cos-stable-109-17800-147-54"
  }

  network_interface {
    network    = google_compute_network.default.id
    subnetwork = google_compute_subnetwork.default.id
    access_config {
      # add external ip to fetch packages
    }

  }

  boot_disk {
    auto_delete  = true
    initialize_params {
      type  = "pd-standard"
      size  = 10
      image = "https://www.googleapis.com/compute/v1/projects/cos-cloud/global/images/cos-stable-109-17800-147-54"
    }
  }

  metadata = {
    gce-container-declaration = "# DISCLAIMER:\n# This container declaration format is not a public API and may change without\n# notice. Please use gcloud command-line tool or Google Cloud Console to run\n# Containers on Google Compute Engine.\n\nspec:\n  containers:\n  - image: us-docker.pkg.dev/service-extensions-samples/callouts/python-example-basic:main\n    name: callouts-vm\n    securityContext:\n      privileged: false\n    stdin: false\n    tty: false\n    volumeMounts: []\n  restartPolicy: Always\n  volumes: []\n"
    google-logging-enabled = "true"
  }

  lifecycle {
    create_before_destroy = true
  }
}

resource "google_compute_instance_group" "callouts_instance_group" {
  name        = "l7-ilb-callouts-ins-group"
  description = "Terraform test instance group"
  zone        = "us-west1-a"

  instances = [
    google_compute_instance.callouts_instance.id,
  ]

  named_port {
    name = "http"
    port = "80"
  }

  named_port {
    name = "grpc"
    port = "443"
  }
}

resource "google_compute_region_health_check" "callouts_health_check" {
  name     = "l7-ilb-callouts-healthcheck"
  region   = "us-west1"

  http_health_check {
    port = 80
  }

  depends_on = [
    google_compute_region_health_check.default
  ]
}

resource "google_compute_address" "default" {
  name         = "l7-ilb-ip-address"
  project      = "my-project-name"
  region       = "us-west1"
  subnetwork   = google_compute_subnetwork.default.id
  address_type = "INTERNAL"
  purpose      = "GCE_ENDPOINT"
}

resource "google_compute_region_health_check" "default" {
  name    = "l7-ilb-basic-check"
  project = "my-project-name"
  region  = "us-west1"

  http_health_check {
    port_specification = "USE_SERVING_PORT"
  }
}

resource "google_compute_region_backend_service" "url_map" {
  name                  = "l7-ilb-backend-service"
  project               = "my-project-name"
  region                = "us-west1"
  load_balancing_scheme = "INTERNAL_MANAGED"

  health_checks = [google_compute_region_health_check.default.id]
}

resource "google_compute_region_url_map" "default" {
  name            = "l7-ilb-map"
  project         = "my-project-name"
  region          = "us-west1"
  default_service = google_compute_region_backend_service.url_map.id
}

resource "google_compute_region_target_http_proxy" "default" {
  name    = "l7-ilb-proxy"
  project = "my-project-name"
  region  = "us-west1"
  url_map = google_compute_region_url_map.default.id
}

resource "google_compute_forwarding_rule" "default" {
  name                  = "l7-ilb-forwarding-rule"
  project               = "my-project-name"
  region                = "us-west1"
  load_balancing_scheme = "INTERNAL_MANAGED"
  network               = google_compute_network.default.id
  subnetwork            = google_compute_subnetwork.default.id
  ip_protocol           = "TCP"
  port_range            = "80"
  target                = google_compute_region_target_http_proxy.default.id
  ip_address            = google_compute_address.default.id

  depends_on = [google_compute_subnetwork.proxy_only]
}

resource "google_compute_region_backend_service" "authz_extension" {
  name    = "authz-service"
  project = "my-project-name"
  region  = "us-west1"

  protocol              = "HTTP2"
  load_balancing_scheme = "INTERNAL_MANAGED"
  port_name             = "grpc"

  health_checks = [google_compute_region_health_check.callouts_health_check.id] 
  backend {
    group = google_compute_instance_group.callouts_instance_group.id
    balancing_mode = "UTILIZATION"
    capacity_scaler = 1.0
  }
}

resource "google_network_services_authz_extension" "default" {
  name     = "my-authz-ext"
  project  = "my-project-name"
  location = "us-west1"

  description           = "my description"
  load_balancing_scheme = "INTERNAL_MANAGED"
  authority             = "ext11.com"
  service               = google_compute_region_backend_service.authz_extension.self_link
  timeout               = "0.1s"
  fail_open             = false
  forward_headers       = ["Authorization"]
}

resource "google_network_security_authz_policy" "default" {
  name        = "my-authz-policy"
  project     = "my-project-name"
  location    = "us-west1"
  description = "my description"

  target {
    load_balancing_scheme = "INTERNAL_MANAGED"
    resources = [ google_compute_forwarding_rule.default.self_link ]
  }

  action = "CUSTOM"
  custom_provider {
    authz_extension {
      resources = [ google_network_services_authz_extension.default.id ]
    }
  }

  http_rules {
    from {
      not_sources {
          ip_blocks {
          length = 24
          prefix = "10.1.5.0"
        }
        principals {
          principal_selector = "CLIENT_CERT_URI_SAN"
          principal {
            ignore_case = true
            exact       = "exact"
          }
        }
      }
    }
    to {
      operations {
        header_set {
          headers {
            name = "test-header"
            value {
              exact = "test-value"
              ignore_case = true
            }
          }
        }
      }
    }
  }
}
```
<div class = "oics-button" style="float: right; margin: 0 0 -15px">
  <a href="https://console.cloud.google.com/cloudshell/open?cloudshell_git_repo=https%3A%2F%2Fgithub.com%2Fterraform-google-modules%2Fdocs-examples.git&cloudshell_image=gcr.io%2Fcloudshell-images%2Fcloudshell%3Alatest&cloudshell_print=.%2Fmotd&cloudshell_tutorial=.%2Ftutorial.md&cloudshell_working_dir=network_security_authz_policy_mcp&open_in_editor=main.tf" target="_blank">
    <img alt="Open in Cloud Shell" src="//gstatic.com/cloudssh/images/open-btn.svg" style="max-height: 44px; margin: 32px auto; max-width: 100%;">
  </a>
</div>
## Example Usage - Network Security Authz Policy Mcp


```hcl
data "google_project" "project" {}

resource "google_network_security_authz_policy" "default" {
  name        = "my-mcp-policy"
  location    = "us-west1"

  target {
    resources = [ "projects/${data.google_project.project.project_id}/locations/us-west1/agentGateways/gateway1" ]
  }

  policy_profile = "REQUEST_AUTHZ"
  action = "ALLOW"

  http_rules {
    to {
      operations {
        mcp {
          base_protocol_methods_option = "MATCH_BASE_PROTOCOL_METHODS"
          methods {
            name = "tools"
          }

          methods {
            name = "tools/call"
            params {
              exact = "foo"
            }
          }
        }
      }
    }
  }
}
```

## Argument Reference

The following arguments are supported:


* `target` -
  (Required)
  Specifies the set of resources to which this policy should be applied to.
  Structure is [documented below](#nested_target).

* `action` -
  (Required)
  When the action is CUSTOM, customProvider must be specified.
  When the action is ALLOW, only requests matching the policy will be allowed.
  When the action is DENY, only requests matching the policy will be denied.
  When a request arrives, the policies are evaluated in the following order:
  1. If there is a CUSTOM policy that matches the request, the CUSTOM policy is evaluated using the custom authorization providers and the request is denied if the provider rejects the request.
  2. If there are any DENY policies that match the request, the request is denied.
  3. If there are no ALLOW policies for the resource or if any of the ALLOW policies match the request, the request is allowed.
  4. Else the request is denied by default if none of the configured AuthzPolicies with ALLOW action match the request.
  Possible values are: `ALLOW`, `DENY`, `CUSTOM`.

* `name` -
  (Required)
  Identifier. Name of the AuthzPolicy resource.

* `location` -
  (Required)
  The location of the resource.


* `description` -
  (Optional)
  A human-readable description of the resource.

* `policy_profile` -
  (Optional)
  Defines the type of authorization being performed. `REQUEST_AUTHZ` applies to request authorization. CUSTOM
  authorization policies with Authz extensions will be allowed with ext_authz or ext_proc protocols. Extensions are
  invoked only once when the request headers arrive. `CONTENT_AUTHZ` applies to content security, sanitization, etc.
  Only CUSTOM action is allowed in this policy profile. AuthzExtensions in the custom provider must support ext_proc
  protocol and be capable of receiving all ext_proc events (REQUEST_HEADERS, REQUEST_BODY, REQUEST_TRAILERS,
  RESPONSE_HEADERS, RESPONSE_BODY, RESPONSE_TRAILERS) with FULL_DUPLEX_STREAMED body send mode.
  Possible values are: `REQUEST_AUTHZ`, `CONTENT_AUTHZ`.

* `labels` -
  (Optional)
  Set of labels associated with the AuthzExtension resource.

  **Note**: This field is non-authoritative, and will only manage the labels present in your configuration.
  Please refer to the field `effective_labels` for all of the labels present on the resource.

* `http_rules` -
  (Optional)
  A list of authorization HTTP rules to match against the incoming request.A policy match occurs when at least one HTTP rule matches the request or when no HTTP rules are specified in the policy. At least one HTTP Rule is required for Allow or Deny Action.
  Limited to 5 rules.
  Structure is [documented below](#nested_http_rules).

* `custom_provider` -
  (Optional)
  Required if the action is CUSTOM. Allows delegating authorization decisions to Cloud IAP or to Service Extensions. One of cloudIap or authzExtension must be specified.
  Structure is [documented below](#nested_custom_provider).

* `project` - (Optional) The ID of the project in which the resource belongs.
    If it is not provided, the provider project is used.



<a name="nested_target"></a>The `target` block supports:

* `load_balancing_scheme` -
  (Optional)
  Required when targeting forwarding rules and secure web proxy. Must not be specified when targeting Agent
  Gateway. All resources referenced by this policy and extensions must share the same load balancing scheme.
  For more information, refer to [Backend services overview](https://cloud.google.com/load-balancing/docs/backend-service).
  Possible values are: `INTERNAL_MANAGED`, `EXTERNAL_MANAGED`, `INTERNAL_SELF_MANAGED`.

* `resources` -
  (Optional)
  A list of references to the Forwarding Rules or Secure Web Proxy Gateways or Agent Gateways on which this
  policy will be applied.

<a name="nested_http_rules"></a>The `http_rules` block supports:

* `from` -
  (Optional)
  Describes properties of one or more sources of a request.
  Structure is [documented below](#nested_http_rules_from).

* `to` -
  (Optional)
  Describes properties of one or more targets of a request
  Structure is [documented below](#nested_http_rules_to).

* `when` -
  (Optional)
  CEL expression that describes the conditions to be satisfied for the action. The result of the CEL expression is ANDed with the from and to. Refer to the CEL language reference for a list of available attributes.


<a name="nested_http_rules_from"></a>The `from` block supports:

* `sources` -
  (Optional)
  Describes the properties of a request's sources. At least one of sources or notSources must be specified. Limited to 1 source. A match occurs when ANY source (in sources or notSources) matches the request. Within a single source, the match follows AND semantics across fields and OR semantics within a single field, i.e. a match occurs when ANY principal matches AND ANY ipBlocks match.
  Structure is [documented below](#nested_http_rules_from_sources).

* `not_sources` -
  (Optional)
  Describes the negated properties of request sources. Matches requests from sources that do not match the criteria specified in this field. At least one of sources or notSources must be specified. Limited to 1 not_source.
  Structure is [documented below](#nested_http_rules_from_not_sources).


<a name="nested_http_rules_from_sources"></a>The `sources` block supports:

* `ip_blocks` -
  (Optional)
  A list of IP addresses or IP address ranges to match against the source IP address of the request. Limited to 10 ipBlocks per Authorization Policy
  Structure is [documented below](#nested_http_rules_from_sources_ip_blocks).

* `principals` -
  (Optional)
  A list of identities derived from the client's certificate. This field will not match on a request unless mutual TLS is enabled for the Forwarding rule or Gateway. Each identity is a string whose value is matched against the URI SAN, or DNS SAN or the subject field in the client's certificate. The match can be exact, prefix, suffix or a substring match. One of exact, prefix, suffix or contains must be specified.
  Limited to 5 principals.
  Structure is [documented below](#nested_http_rules_from_sources_principals).

* `resources` -
  (Optional)
  A list of resources to match against the resource of the source VM of a request.
  Limited to 5 resources.
  Structure is [documented below](#nested_http_rules_from_sources_resources).


<a name="nested_http_rules_from_sources_ip_blocks"></a>The `ip_blocks` block supports:

* `prefix` -
  (Required)
  The address prefix.

* `length` -
  (Required)
  The length of the address range.

<a name="nested_http_rules_from_sources_principals"></a>The `principals` block supports:

* `principal_selector` -
  (Optional)
  An enum to decide what principal value the principal rule will match against. If not specified, the PrincipalSelector is CLIENT_CERT_URI_SAN.
  Default value is `CLIENT_CERT_URI_SAN`.
  Possible values are: `PRINCIPAL_SELECTOR_UNSPECIFIED`, `CLIENT_CERT_URI_SAN`, `CLIENT_CERT_DNS_NAME_SAN`, `CLIENT_CERT_COMMON_NAME`.

* `principal` -
  (Optional)
  Required. A non-empty string whose value is matched against the principal value based on the principalSelector.
  Only exact match can be applied for CLIENT_CERT_URI_SAN, CLIENT_CERT_DNS_NAME_SAN, CLIENT_CERT_COMMON_NAME selectors.
  Structure is [documented below](#nested_http_rules_from_sources_principals_principal).

* `ignore_case` -
  (Optional, Deprecated)
  If true, indicates the exact/prefix/suffix/contains matching should be case insensitive. For example, the matcher data will match both input string Data and data if set to true.

  ~> **Warning:** `principals.ignore_case` is deprecated and will be removed in a future major release. Use `principals.principal.ignore_case` instead.

* `exact` -
  (Optional, Deprecated)
  The input string must match exactly the string specified here.
  Examples:
  * abc only matches the value abc.

  ~> **Warning:** `principals.exact` is deprecated and will be removed in a future major release. Use `principals.principal.exact` instead.

* `prefix` -
  (Optional, Deprecated)
  The input string must have the prefix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value abc.xyz

  ~> **Warning:** `principals.prefix` is deprecated and will be removed in a future major release. Use `principals.principal.prefix` instead.

* `suffix` -
  (Optional, Deprecated)
  The input string must have the suffix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc

  ~> **Warning:** `principals.suffix` is deprecated and will be removed in a future major release. Use `principals.principal.suffix` instead.

* `contains` -
  (Optional, Deprecated)
  The input string must have the substring specified here. Note: empty contains match is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc.def

  ~> **Warning:** `principals.contains` is deprecated and will be removed in a future major release. Use `principals.principal.contains` instead.


<a name="nested_http_rules_from_sources_principals_principal"></a>The `principal` block supports:

* `ignore_case` -
  (Optional)
  If true, indicates the exact/prefix/suffix/contains matching should be case insensitive. For example, the matcher data will match both input string Data and data if set to true.

* `exact` -
  (Optional)
  The input string must match exactly the string specified here.
  Examples:
  * abc only matches the value abc.

* `prefix` -
  (Optional)
  The input string must have the prefix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value abc.xyz

* `suffix` -
  (Optional)
  The input string must have the suffix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc

* `contains` -
  (Optional)
  The input string must have the substring specified here. Note: empty contains match is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc.def

<a name="nested_http_rules_from_sources_resources"></a>The `resources` block supports:

* `tag_value_id_set` -
  (Optional)
  A list of resource tag value permanent IDs to match against the resource manager tags value associated with the source VM of a request.
  Structure is [documented below](#nested_http_rules_from_sources_resources_tag_value_id_set).

* `iam_service_account` -
  (Optional)
  An IAM service account to match against the source service account of the VM sending the request.
  Structure is [documented below](#nested_http_rules_from_sources_resources_iam_service_account).


<a name="nested_http_rules_from_sources_resources_tag_value_id_set"></a>The `tag_value_id_set` block supports:

* `ids` -
  (Optional)
  A list of resource tag value permanent IDs to match against the resource manager tags value associated with the source VM of a request. The match follows AND semantics which means all the ids must match.
  Limited to 5 matches.

<a name="nested_http_rules_from_sources_resources_iam_service_account"></a>The `iam_service_account` block supports:

* `ignore_case` -
  (Optional)
  If true, indicates the exact/prefix/suffix/contains matching should be case insensitive. For example, the matcher data will match both input string Data and data if set to true.

* `exact` -
  (Optional)
  The input string must match exactly the string specified here.
  Examples:
  * abc only matches the value abc.

* `prefix` -
  (Optional)
  The input string must have the prefix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value abc.xyz

* `suffix` -
  (Optional)
  The input string must have the suffix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc

* `contains` -
  (Optional)
  The input string must have the substring specified here. Note: empty contains match is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc.def

<a name="nested_http_rules_from_not_sources"></a>The `not_sources` block supports:

* `ip_blocks` -
  (Optional)
  A list of IP addresses or IP address ranges to match against the source IP address of the request. Limited to 10 ipBlocks per Authorization Policy
  Structure is [documented below](#nested_http_rules_from_not_sources_ip_blocks).

* `principals` -
  (Optional)
  A list of identities derived from the client's certificate. This field will not match on a request unless mutual TLS is enabled for the Forwarding rule or Gateway. Each identity is a string whose value is matched against the URI SAN, or DNS SAN or the subject field in the client's certificate. The match can be exact, prefix, suffix or a substring match. One of exact, prefix, suffix or contains must be specified.
  Limited to 5 principals.
  Structure is [documented below](#nested_http_rules_from_not_sources_principals).

* `resources` -
  (Optional)
  A list of resources to match against the resource of the source VM of a request.
  Limited to 5 resources.
  Structure is [documented below](#nested_http_rules_from_not_sources_resources).


<a name="nested_http_rules_from_not_sources_ip_blocks"></a>The `ip_blocks` block supports:

* `prefix` -
  (Required)
  The address prefix.

* `length` -
  (Required)
  The length of the address range.

<a name="nested_http_rules_from_not_sources_principals"></a>The `principals` block supports:

* `principal_selector` -
  (Optional)
  An enum to decide what principal value the principal rule will match against. If not specified, the PrincipalSelector is CLIENT_CERT_URI_SAN.
  Default value is `CLIENT_CERT_URI_SAN`.
  Possible values are: `PRINCIPAL_SELECTOR_UNSPECIFIED`, `CLIENT_CERT_URI_SAN`, `CLIENT_CERT_DNS_NAME_SAN`, `CLIENT_CERT_COMMON_NAME`.

* `principal` -
  (Optional)
  Required. A non-empty string whose value is matched against the principal value based on the principalSelector.
  Only exact match can be applied for CLIENT_CERT_URI_SAN, CLIENT_CERT_DNS_NAME_SAN, CLIENT_CERT_COMMON_NAME selectors.
  Structure is [documented below](#nested_http_rules_from_not_sources_principals_principal).

* `ignore_case` -
  (Optional, Deprecated)
  If true, indicates the exact/prefix/suffix/contains matching should be case insensitive. For example, the matcher data will match both input string Data and data if set to true.

  ~> **Warning:** `principals.ignore_case` is deprecated and will be removed in a future major release. Use `principals.principal.ignore_case` instead.

* `exact` -
  (Optional, Deprecated)
  The input string must match exactly the string specified here.
  Examples:
  * abc only matches the value abc.

  ~> **Warning:** `principals.exact` is deprecated and will be removed in a future major release. Use `principals.principal.exact` instead.

* `prefix` -
  (Optional, Deprecated)
  The input string must have the prefix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value abc.xyz

  ~> **Warning:** `principals.prefix` is deprecated and will be removed in a future major release. Use `principals.principal.prefix` instead.

* `suffix` -
  (Optional, Deprecated)
  The input string must have the suffix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc

  ~> **Warning:** `principals.suffix` is deprecated and will be removed in a future major release. Use `principals.principal.suffix` instead.

* `contains` -
  (Optional, Deprecated)
  The input string must have the substring specified here. Note: empty contains match is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc.def

  ~> **Warning:** `principals.contains` is deprecated and will be removed in a future major release. Use `principals.principal.contains` instead.


<a name="nested_http_rules_from_not_sources_principals_principal"></a>The `principal` block supports:

* `ignore_case` -
  (Optional)
  If true, indicates the exact/prefix/suffix/contains matching should be case insensitive. For example, the matcher data will match both input string Data and data if set to true.

* `exact` -
  (Optional)
  The input string must match exactly the string specified here.
  Examples:
  * abc only matches the value abc.

* `prefix` -
  (Optional)
  The input string must have the prefix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value abc.xyz

* `suffix` -
  (Optional)
  The input string must have the suffix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc

* `contains` -
  (Optional)
  The input string must have the substring specified here. Note: empty contains match is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc.def

<a name="nested_http_rules_from_not_sources_resources"></a>The `resources` block supports:

* `tag_value_id_set` -
  (Optional)
  A list of resource tag value permanent IDs to match against the resource manager tags value associated with the source VM of a request.
  Structure is [documented below](#nested_http_rules_from_not_sources_resources_tag_value_id_set).

* `iam_service_account` -
  (Optional)
  An IAM service account to match against the source service account of the VM sending the request.
  Structure is [documented below](#nested_http_rules_from_not_sources_resources_iam_service_account).


<a name="nested_http_rules_from_not_sources_resources_tag_value_id_set"></a>The `tag_value_id_set` block supports:

* `ids` -
  (Optional)
  A list of resource tag value permanent IDs to match against the resource manager tags value associated with the source VM of a request. The match follows AND semantics which means all the ids must match.
  Limited to 5 matches.

<a name="nested_http_rules_from_not_sources_resources_iam_service_account"></a>The `iam_service_account` block supports:

* `ignore_case` -
  (Optional)
  If true, indicates the exact/prefix/suffix/contains matching should be case insensitive. For example, the matcher data will match both input string Data and data if set to true.

* `exact` -
  (Optional)
  The input string must match exactly the string specified here.
  Examples:
  * abc only matches the value abc.

* `prefix` -
  (Optional)
  The input string must have the prefix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value abc.xyz

* `suffix` -
  (Optional)
  The input string must have the suffix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc

* `contains` -
  (Optional)
  The input string must have the substring specified here. Note: empty contains match is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc.def

<a name="nested_http_rules_to"></a>The `to` block supports:

* `operations` -
  (Optional)
  Describes properties of one or more targets of a request. At least one of operations or notOperations must be specified. Limited to 1 operation. A match occurs when ANY operation (in operations or notOperations) matches. Within an operation, the match follows AND semantics across fields and OR semantics within a field, i.e. a match occurs when ANY path matches AND ANY header matches and ANY method matches.
  Structure is [documented below](#nested_http_rules_to_operations).

* `not_operations` -
  (Optional)
  Describes the negated properties of the targets of a request. Matches requests for operations that do not match the criteria specified in this field. At least one of operations or notOperations must be specified. Limited to 1 not_operation.
  Structure is [documented below](#nested_http_rules_to_not_operations).


<a name="nested_http_rules_to_operations"></a>The `operations` block supports:

* `header_set` -
  (Optional)
  A list of headers to match against in http header.
  Structure is [documented below](#nested_http_rules_to_operations_header_set).

* `hosts` -
  (Optional)
  A list of HTTP Hosts to match against. The match can be one of exact, prefix, suffix, or contains (substring match). Matches are always case sensitive unless the ignoreCase is set.
  Limited to 10 matches.
  Structure is [documented below](#nested_http_rules_to_operations_hosts).

* `paths` -
  (Optional)
  A list of paths to match against. The match can be one of exact, prefix, suffix, or contains (substring match). Matches are always case sensitive unless the ignoreCase is set.
  Limited to 10 matches.
  Note that this path match includes the query parameters. For gRPC services, this should be a fully-qualified name of the form /package.service/method.
  Structure is [documented below](#nested_http_rules_to_operations_paths).

* `methods` -
  (Optional)
  A list of HTTP methods to match against. Each entry must be a valid HTTP method name (GET, PUT, POST, HEAD, PATCH, DELETE, OPTIONS). It only allows exact match and is always case sensitive.

* `mcp` -
  (Optional)
  Defines the MCP protocol attributes to match on. MCP based match is allowed only when the AuthzPolicy points to an AgentGateway.
  Structure is [documented below](#nested_http_rules_to_operations_mcp).


<a name="nested_http_rules_to_operations_header_set"></a>The `header_set` block supports:

* `headers` -
  (Optional)
  A list of headers to match against in http header. The match can be one of exact, prefix, suffix, or contains (substring match). The match follows AND semantics which means all the headers must match. Matches are always case sensitive unless the ignoreCase is set. Limited to 10 matches.
  Structure is [documented below](#nested_http_rules_to_operations_header_set_headers).


<a name="nested_http_rules_to_operations_header_set_headers"></a>The `headers` block supports:

* `name` -
  (Optional)
  Specifies the name of the header in the request.

* `value` -
  (Optional)
  Specifies how the header match will be performed.
  Structure is [documented below](#nested_http_rules_to_operations_header_set_headers_value).


<a name="nested_http_rules_to_operations_header_set_headers_value"></a>The `value` block supports:

* `ignore_case` -
  (Optional)
  If true, indicates the exact/prefix/suffix/contains matching should be case insensitive. For example, the matcher data will match both input string Data and data if set to true.

* `exact` -
  (Optional)
  The input string must match exactly the string specified here.
  Examples:
  * abc only matches the value abc.

* `prefix` -
  (Optional)
  The input string must have the prefix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value abc.xyz

* `suffix` -
  (Optional)
  The input string must have the suffix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc

* `contains` -
  (Optional)
  The input string must have the substring specified here. Note: empty contains match is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc.def

<a name="nested_http_rules_to_operations_hosts"></a>The `hosts` block supports:

* `ignore_case` -
  (Optional)
  If true, indicates the exact/prefix/suffix/contains matching should be case insensitive. For example, the matcher data will match both input string Data and data if set to true.

* `exact` -
  (Optional)
  The input string must match exactly the string specified here.
  Examples:
  * abc only matches the value abc.

* `prefix` -
  (Optional)
  The input string must have the prefix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value abc.xyz

* `suffix` -
  (Optional)
  The input string must have the suffix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc

* `contains` -
  (Optional)
  The input string must have the substring specified here. Note: empty contains match is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc.def

<a name="nested_http_rules_to_operations_paths"></a>The `paths` block supports:

* `ignore_case` -
  (Optional)
  If true, indicates the exact/prefix/suffix/contains matching should be case insensitive. For example, the matcher data will match both input string Data and data if set to true.

* `exact` -
  (Optional)
  The input string must match exactly the string specified here.
  Examples:
  * abc only matches the value abc.

* `prefix` -
  (Optional)
  The input string must have the prefix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value abc.xyz

* `suffix` -
  (Optional)
  The input string must have the suffix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc

* `contains` -
  (Optional)
  The input string must have the substring specified here. Note: empty contains match is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc.def

<a name="nested_http_rules_to_operations_mcp"></a>The `mcp` block supports:

* `base_protocol_methods_option` -
  (Optional)
  If specified, matches on the MCP protocol’s non-access specific methods namely: * initialize/ * completion/ * logging/ * notifications/ * ping
  Default value is `SKIP_BASE_PROTOCOL_METHODS`.
  Possible values are: `SKIP_BASE_PROTOCOL_METHODS`, `MATCH_BASE_PROTOCOL_METHODS`.

* `methods` -
  (Optional)
  Defines a set of MCP methods and associated parameters to match on. It is recommended to use this field to match on tools, prompts and resource accesses while setting the includeBaseProtocolMethods to true to match on all the other MCP protocol methods.
  Structure is [documented below](#nested_http_rules_to_operations_mcp_methods).


<a name="nested_http_rules_to_operations_mcp_methods"></a>The `methods` block supports:

* `name` -
  (Required)
  The MCP method to match against. Allowed values are as follows:
  1) “tools”, “prompts”, “resources” - these will match against all sub methods under the respective methods.
  2) “prompts/list”, “tools/list”, “resources/list”, “resources/templates/list”
  3) “prompts/get”, “tools/call”, “resources/subscribe”, “resources/unsubscribe”, “resources/read”
  Params cannot be specified for categories 1) and 2).

* `params` -
  (Optional)
  MCP method parameters to match against.
  Structure is [documented below](#nested_http_rules_to_operations_mcp_methods_params).


<a name="nested_http_rules_to_operations_mcp_methods_params"></a>The `params` block supports:

* `exact` -
  (Optional)
  An exact match on the MCP method parameter name.

* `prefix` -
  (Optional)
  A prefix match on the MCP method parameter name.

* `suffix` -
  (Optional)
  A suffix match on the MCP method parameter name.

* `contains` -
  (Optional)
  A substring match on the MCP method parameter name.

* `ignore_case` -
  (Optional)
  Specifies that the string match should be case insensitive.

<a name="nested_http_rules_to_not_operations"></a>The `not_operations` block supports:

* `header_set` -
  (Optional)
  A list of headers to match against in http header.
  Structure is [documented below](#nested_http_rules_to_not_operations_header_set).

* `hosts` -
  (Optional)
  A list of HTTP Hosts to match against. The match can be one of exact, prefix, suffix, or contains (substring match). Matches are always case sensitive unless the ignoreCase is set.
  Limited to 10 matches.
  Structure is [documented below](#nested_http_rules_to_not_operations_hosts).

* `paths` -
  (Optional)
  A list of paths to match against. The match can be one of exact, prefix, suffix, or contains (substring match). Matches are always case sensitive unless the ignoreCase is set.
  Limited to 10 matches.
  Note that this path match includes the query parameters. For gRPC services, this should be a fully-qualified name of the form /package.service/method.
  Structure is [documented below](#nested_http_rules_to_not_operations_paths).

* `methods` -
  (Optional)
  A list of HTTP methods to match against. Each entry must be a valid HTTP method name (GET, PUT, POST, HEAD, PATCH, DELETE, OPTIONS). It only allows exact match and is always case sensitive.


<a name="nested_http_rules_to_not_operations_header_set"></a>The `header_set` block supports:

* `headers` -
  (Optional)
  A list of headers to match against in http header. The match can be one of exact, prefix, suffix, or contains (substring match). The match follows AND semantics which means all the headers must match. Matches are always case sensitive unless the ignoreCase is set. Limited to 10 matches.
  Structure is [documented below](#nested_http_rules_to_not_operations_header_set_headers).


<a name="nested_http_rules_to_not_operations_header_set_headers"></a>The `headers` block supports:

* `name` -
  (Optional)
  Specifies the name of the header in the request.

* `value` -
  (Optional)
  Specifies how the header match will be performed.
  Structure is [documented below](#nested_http_rules_to_not_operations_header_set_headers_value).


<a name="nested_http_rules_to_not_operations_header_set_headers_value"></a>The `value` block supports:

* `ignore_case` -
  (Optional)
  If true, indicates the exact/prefix/suffix/contains matching should be case insensitive. For example, the matcher data will match both input string Data and data if set to true.

* `exact` -
  (Optional)
  The input string must match exactly the string specified here.
  Examples:
  * abc only matches the value abc.

* `prefix` -
  (Optional)
  The input string must have the prefix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value abc.xyz

* `suffix` -
  (Optional)
  The input string must have the suffix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc

* `contains` -
  (Optional)
  The input string must have the substring specified here. Note: empty contains match is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc.def

<a name="nested_http_rules_to_not_operations_hosts"></a>The `hosts` block supports:

* `ignore_case` -
  (Optional)
  If true, indicates the exact/prefix/suffix/contains matching should be case insensitive. For example, the matcher data will match both input string Data and data if set to true.

* `exact` -
  (Optional)
  The input string must match exactly the string specified here.
  Examples:
  * abc only matches the value abc.

* `prefix` -
  (Optional)
  The input string must have the prefix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value abc.xyz

* `suffix` -
  (Optional)
  The input string must have the suffix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc

* `contains` -
  (Optional)
  The input string must have the substring specified here. Note: empty contains match is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc.def

<a name="nested_http_rules_to_not_operations_paths"></a>The `paths` block supports:

* `ignore_case` -
  (Optional)
  If true, indicates the exact/prefix/suffix/contains matching should be case insensitive. For example, the matcher data will match both input string Data and data if set to true.

* `exact` -
  (Optional)
  The input string must match exactly the string specified here.
  Examples:
  * abc only matches the value abc.

* `prefix` -
  (Optional)
  The input string must have the prefix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value abc.xyz

* `suffix` -
  (Optional)
  The input string must have the suffix specified here. Note: empty prefix is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc

* `contains` -
  (Optional)
  The input string must have the substring specified here. Note: empty contains match is not allowed, please use regex instead.
  Examples:
  * abc matches the value xyz.abc.def

<a name="nested_custom_provider"></a>The `custom_provider` block supports:

* `cloud_iap` -
  (Optional)
  Delegates authorization decisions to Cloud IAP. Applicable only for managed load balancers. Enabling Cloud IAP at the AuthzPolicy level is not compatible with Cloud IAP settings in the BackendService. Enabling IAP in both places will result in request failure. Ensure that IAP is enabled in either the AuthzPolicy or the BackendService but not in both places.
  Structure is [documented below](#nested_custom_provider_cloud_iap).

* `authz_extension` -
  (Optional)
  Delegate authorization decision to user authored Service Extension. Only one of cloudIap or authzExtension can be specified.
  Structure is [documented below](#nested_custom_provider_authz_extension).


<a name="nested_custom_provider_cloud_iap"></a>The `cloud_iap` block supports:

* `enabled` -
  (Required)
  Enable Cloud IAP at the AuthzPolicy level.

<a name="nested_custom_provider_authz_extension"></a>The `authz_extension` block supports:

* `resources` -
  (Required)
  A list of references to authorization extensions that will be invoked for requests matching this policy. Limited to 1 custom provider.

## Attributes Reference

In addition to the arguments listed above, the following computed attributes are exported:

* `id` - an identifier for the resource with format `projects/{{project}}/locations/{{location}}/authzPolicies/{{name}}`

* `create_time` -
  The timestamp when the resource was created.

* `update_time` -
  The timestamp when the resource was updated.

* `terraform_labels` -
  The combination of labels configured directly on the resource
   and default labels configured on the provider.

* `effective_labels` -
  All of labels (key/value pairs) present on the resource in GCP, including the labels configured through Terraform, other clients and services.


## Timeouts

This resource provides the following
[Timeouts](https://developer.hashicorp.com/terraform/plugin/sdkv2/resources/retries-and-customizable-timeouts) configuration options:

- `create` - Default is 30 minutes.
- `update` - Default is 30 minutes.
- `delete` - Default is 30 minutes.

## Import


AuthzPolicy can be imported using any of these accepted formats:

* `projects/{{project}}/locations/{{location}}/authzPolicies/{{name}}`
* `{{project}}/{{location}}/{{name}}`
* `{{location}}/{{name}}`
* `{{name}}`


In Terraform v1.5.0 and later, use an [`import` block](https://developer.hashicorp.com/terraform/language/import) to import AuthzPolicy using one of the formats above. For example:

```tf
import {
  id = "projects/{{project}}/locations/{{location}}/authzPolicies/{{name}}"
  to = google_network_security_authz_policy.default
}
```

When using the [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import), AuthzPolicy can be imported using one of the formats above. For example:

```
$ terraform import google_network_security_authz_policy.default projects/{{project}}/locations/{{location}}/authzPolicies/{{name}}
$ terraform import google_network_security_authz_policy.default {{project}}/{{location}}/{{name}}
$ terraform import google_network_security_authz_policy.default {{location}}/{{name}}
$ terraform import google_network_security_authz_policy.default {{name}}
```

## User Project Overrides

This resource supports [User Project Overrides](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference#user_project_override).

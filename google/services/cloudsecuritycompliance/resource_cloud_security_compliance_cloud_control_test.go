// Copyright (c) HashiCorp, Inc.
// SPDX-License-Identifier: MPL-2.0
// ----------------------------------------------------------------------------
//
//	***     AUTO GENERATED CODE    ***    Type: Handwritten     ***
//
// ----------------------------------------------------------------------------
//
//	This code is generated by Magic Modules using the following:
//
//	Source file: https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/terraform/services/cloudsecuritycompliance/resource_cloud_security_compliance_cloud_control_test.go
//
//	DO NOT EDIT this file directly. Any changes made to this file will be
//	overwritten during the next generation cycle.
//
// ----------------------------------------------------------------------------
package cloudsecuritycompliance_test

import (
	"testing"

	"github.com/hashicorp/terraform-plugin-testing/helper/resource"

	"github.com/hashicorp/terraform-plugin-testing/plancheck"
	"github.com/hashicorp/terraform-provider-google/google/acctest"
	"github.com/hashicorp/terraform-provider-google/google/envvar"
)

func testAccCloudSecurityComplianceCloudControl_basic(context map[string]interface{}) string {
	return acctest.Nprintf(`
resource "google_cloud_security_compliance_cloud_control" "example" {
	organization      = "%{org_id}"
	location          = "global"
	cloud_control_id  = "tf-test-%{random_suffix}"
	display_name      = "TF Test CloudControl"
	description       = "A test cloud control for security compliance"
	categories        = ["CC_CATEGORY_INFRASTRUCTURE"]
	severity          = "HIGH"
	finding_category  = "SECURITY_POLICY"
	remediation_steps = "Review and update the security configuration according to best practices."
	
	supported_cloud_providers        = ["GCP"]
	
	rules {
		description         = "Ensure compute instances have secure boot enabled"
		rule_action_types   = ["RULE_ACTION_TYPE_DETECTIVE"]
		
		cel_expression {
			expression = "resource.data.shieldedInstanceConfig.enableSecureBoot == true"
			resource_types_values {
				values = ["compute.googleapis.com/Instance"]
			}
		}
	}
	
	parameter_spec {
		name         = "location"
		display_name = "Resource Location"
		description  = "The location where the resource should be deployed"
		value_type   = "STRING"
		is_required  = true
		
		default_value {
			string_value = "us-central1"
		}
		
		validation {
			regexp_pattern {
				pattern = "^[a-z]+-[a-z]+[0-9]$"
			}
		}

		sub_parameters {
			name         = "sub-location"
			display_name = "Sub Location"
			description  = "A sub-parameter for location"
			value_type   = "STRING"
			is_required  = true
			default_value {
				string_value = "us-central1-a"
			}
		}
	}

	parameter_spec {
		name         = "oneof-parameter"
		display_name = "Oneof Parameter"
		description  = "A parameter testing oneof_value"
		value_type   = "ONEOF"
		is_required  = true
		
		default_value {
			oneof_value {
				name = "test-oneof"
				parameter_value {
					string_value = "test-value"
				}
			}
		}
		
		validation {
			allowed_values {
				values {
					oneof_value {
						name = "test-oneof"
						parameter_value {
							string_value = "test-value"
						}
					}
				}
			}
		}

		sub_parameters {
			name         = "sub-oneof"
			display_name = "Sub Oneof"
			description  = "A sub-parameter for oneof"
			value_type   = "ONEOF"
			is_required  = true
			default_value {
				oneof_value {
					name = "sub-test-oneof"
					parameter_value {
						string_list_value {
							values = ["val1", "val2"]
						}
					}
				}
			}
			substitution_rules {
				attribute_substitution_rule {
					attribute = "resource.data.name"
				}
			}
			validation {
				allowed_values {
					values {
						oneof_value {
							name = "sub-test-oneof"
							parameter_value {
								string_list_value {
									values = ["val1", "val2"]
								}
							}
						}
					}
				}
			}
		}
		sub_parameters {
			name         = "sub-bool"
			display_name = "Sub Bool"
			description  = "A sub-parameter for bool"
			value_type   = "BOOLEAN"
			is_required  = true
			default_value {
				bool_value = true
			}
			validation {
				allowed_values {
					values {
						bool_value = true
					}
				}
			}
		}
		sub_parameters {
			name         = "sub-number"
			display_name = "Sub Number"
			description  = "A sub-parameter for number"
			value_type   = "NUMBER"
			is_required  = true
			default_value {
				number_value = 123.45
			}
			validation {
				allowed_values {
					values {
						number_value = 123.45
					}
				}
			}
		}
		sub_parameters {
			name         = "sub-stringlist"
			display_name = "Sub String List"
			description  = "A sub-parameter for string list"
			value_type   = "STRINGLIST"
			is_required  = true
			default_value {
				string_list_value {
					values = ["a", "b"]
				}
			}
			validation {
				allowed_values {
					values {
						string_list_value {
							values = ["a", "b"]
						}
					}
				}
			}
		}
		sub_parameters {
			name         = "sub-oneof-bool"
			display_name = "Sub Oneof Bool"
			description  = "A sub-parameter for oneof bool"
			value_type   = "ONEOF"
			is_required  = true
			default_value {
				oneof_value {
					name = "sub-test-oneof-bool"
					parameter_value {
						bool_value = true
					}
				}
			}
			validation {
				allowed_values {
					values {
						oneof_value {
							name = "sub-test-oneof-bool"
							parameter_value {
								bool_value = true
							}
						}
					}
				}
			}
		}
		sub_parameters {
			name         = "sub-oneof-number"
			display_name = "Sub Oneof Number"
			description  = "A sub-parameter for oneof number"
			value_type   = "ONEOF"
			is_required  = true
			default_value {
				oneof_value {
					name = "sub-test-oneof-number"
					parameter_value {
						number_value = 123.45
					}
				}
			}
			validation {
				allowed_values {
					values {
						oneof_value {
							name = "sub-test-oneof-number"
							parameter_value {
								number_value = 123.45
							}
						}
					}
				}
			}
		}
		sub_parameters {
			name         = "sub-oneof-string"
			display_name = "Sub Oneof String"
			description  = "A sub-parameter for oneof string"
			value_type   = "ONEOF"
			is_required  = true
			default_value {
				oneof_value {
					name = "sub-test-oneof-string"
					parameter_value {
						string_value = "test"
					}
				}
			}
			validation {
				allowed_values {
					values {
						oneof_value {
							name = "sub-test-oneof-string"
							parameter_value {
								string_value = "test"
							}
						}
					}
				}
			}
		}
		sub_parameters {
			name         = "sub-placeholder"
			display_name = "Sub Placeholder"
			description  = "A sub-parameter for placeholder"
			value_type   = "STRING"
			is_required  = true
			default_value {
				string_value = "test"
			}
			substitution_rules {
				placeholder_substitution_rule {
					attribute = "{{name}}"
				}
			}
		}
	}

	parameter_spec {
		name         = "bool-parameter"
		display_name = "Bool Parameter"
		description  = "Testing bool fields"
		value_type   = "ONEOF"
		is_required  = true
		default_value {
			oneof_value {
				name = "test-bool"
				parameter_value {
					bool_value = true
				}
			}
		}
		validation {
			allowed_values {
				values {
					oneof_value {
						name = "test-bool"
						parameter_value {
							bool_value = true
						}
					}
				}
			}
		}
		sub_parameters {
			name         = "sub-allowed-values"
			display_name = "Sub Allowed Values"
			description  = "Testing sub-parameter allowed values"
			value_type   = "STRING"
			is_required  = true
			default_value {
				string_value = "allowed"
			}
			validation {
				allowed_values {
					values {
						string_value = "allowed"
					}
				}
			}
		}
		sub_parameters {
			name         = "sub-regexp-pattern"
			display_name = "Sub Regexp Pattern"
			description  = "Testing sub-parameter regexp pattern"
			value_type   = "STRING"
			is_required  = true
			default_value {
				string_value = "match"
			}
			validation {
				regexp_pattern {
					pattern = "^match$"
				}
			}
		}
	}
	parameter_spec {
		name         = "number-parameter"
		display_name = "Number Parameter"
		description  = "Testing number fields"
		value_type   = "ONEOF"
		is_required  = true
		default_value {
			oneof_value {
				name = "test-number"
				parameter_value {
					number_value = 123.45
				}
			}
		}
		validation {
			allowed_values {
				values {
					oneof_value {
						name = "test-number"
						parameter_value {
							number_value = 123.45
						}
					}
				}
			}
		}
	}
}
`, context)
}

func TestAccCloudSecurityComplianceCloudControl_update(t *testing.T) {
	t.Parallel()

	context := map[string]interface{}{
		"org_id":        envvar.GetTestOrgFromEnv(t),
		"random_suffix": acctest.RandString(t, 10),
	}

	acctest.VcrTest(t, resource.TestCase{
		PreCheck:                 func() { acctest.AccTestPreCheck(t) },
		ProtoV5ProviderFactories: acctest.ProtoV5ProviderFactories(t),
		Steps: []resource.TestStep{
			{
				Config: testAccCloudSecurityComplianceCloudControl_basic(context),
			},
			{
				ResourceName:            "google_cloud_security_compliance_cloud_control.example",
				ImportState:             true,
				ImportStateVerify:       true,
				ImportStateVerifyIgnore: []string{"cloud_control_id", "location", "organization"},
			},
			{
				Config: testAccCloudSecurityComplianceCloudControl_update(context),
				ConfigPlanChecks: resource.ConfigPlanChecks{
					PreApply: []plancheck.PlanCheck{
						plancheck.ExpectResourceAction("google_cloud_security_compliance_cloud_control.example", plancheck.ResourceActionUpdate),
					},
				},
			},
			{
				ResourceName:            "google_cloud_security_compliance_cloud_control.example",
				ImportState:             true,
				ImportStateVerify:       true,
				ImportStateVerifyIgnore: []string{"cloud_control_id", "location", "organization"},
			},
		},
	})
}

func testAccCloudSecurityComplianceCloudControl_update(context map[string]interface{}) string {
	return acctest.Nprintf(`
resource "google_cloud_security_compliance_cloud_control" "example" {
  organization      = "%{org_id}"
  location          = "global"
  cloud_control_id  = "tf-test-%{random_suffix}"

  display_name      = "Updated CloudControl Name"
  description       = "An updated description for the cloud control"
  categories        = ["CC_CATEGORY_INFRASTRUCTURE"]
  severity          = "CRITICAL"
  finding_category  = "SECURITY_POLICY"
  remediation_steps = "Updated remediation steps with more detailed instructions for security configuration."
  
  supported_cloud_providers        = ["GCP"]
  
  rules {
    description         = "Updated rule: Ensure compute instances have secure boot and integrity monitoring enabled"
    rule_action_types   = ["RULE_ACTION_TYPE_DETECTIVE"]
    
    cel_expression {
      expression = "resource.data.shieldedInstanceConfig.enableSecureBoot == true && resource.data.shieldedInstanceConfig.enableIntegrityMonitoring == true"
      resource_types_values {
        values = ["compute.googleapis.com/Instance"]
      }
    }
  }
  
  parameter_spec {
    name         = "region"
    display_name = "Updated Resource Region"
    description  = "Updated description for the region parameter"
    value_type   = "STRING"
    is_required  = true
    
    default_value {
      string_value = "eu"
    }
    
    validation {
      regexp_pattern {
        pattern = "^[a-z]+-[a-z]$"
      }
    }

    sub_parameters {
      name         = "sub-region"
      display_name = "Sub Region"
      description  = "A sub-parameter for region"
      value_type   = "STRING"
      is_required  = true
      default_value {
        string_value = "eu-west"
      }
    }
  }

  parameter_spec {
    name         = "oneof-parameter"
    display_name = "Oneof Parameter"
    description  = "A parameter testing oneof_value"
    value_type   = "ONEOF"
    is_required  = true
    
    default_value {
      oneof_value {
        name = "updated-oneof"
        parameter_value {
          string_value = "updated-value"
        }
      }
    }
    
    validation {
      allowed_values {
        values {
          oneof_value {
            name = "updated-oneof"
            parameter_value {
              string_value = "updated-value"
            }
          }
        }
      }
    }

    sub_parameters {
      name         = "sub-oneof"
      display_name = "Sub Oneof"
      description  = "A sub-parameter for oneof"
      value_type   = "ONEOF"
      is_required  = true
      default_value {
        oneof_value {
          name = "sub-updated-oneof"
          parameter_value {
            string_list_value {
              values = ["val1", "val2"]
            }
          }
        }
      }
      substitution_rules {
        attribute_substitution_rule {
          attribute = "resource.data.name"
        }
      }
      validation {
        allowed_values {
          values {
            oneof_value {
              name = "sub-updated-oneof"
              parameter_value {
                string_list_value {
                  values = ["val1", "val2"]
                }
              }
            }
          }
        }
      }
    }
    sub_parameters {
      name         = "sub-bool"
      display_name = "Sub Bool"
      description  = "A sub-parameter for bool"
      value_type   = "BOOLEAN"
      is_required  = true
      default_value {
        bool_value = true
      }
      validation {
        allowed_values {
          values {
            bool_value = true
          }
        }
      }
    }
    sub_parameters {
      name         = "sub-number"
      display_name = "Sub Number"
      description  = "A sub-parameter for number"
      value_type   = "NUMBER"
      is_required  = true
      default_value {
        number_value = 123.45
      }
      validation {
        allowed_values {
          values {
            number_value = 123.45
          }
        }
      }
    }
    sub_parameters {
      name         = "sub-stringlist"
      display_name = "Sub String List"
      description  = "A sub-parameter for string list"
      value_type   = "STRINGLIST"
      is_required  = true
      default_value {
        string_list_value {
          values = ["a", "b"]
        }
      }
      validation {
        allowed_values {
          values {
            string_list_value {
              values = ["a", "b"]
            }
          }
        }
      }
    }
    sub_parameters {
      name         = "sub-oneof-bool"
      display_name = "Sub Oneof Bool"
      description  = "A sub-parameter for oneof bool"
      value_type   = "ONEOF"
      is_required  = true
      default_value {
        oneof_value {
          name = "sub-test-oneof-bool"
          parameter_value {
            bool_value = true
          }
        }
      }
      validation {
        allowed_values {
          values {
            oneof_value {
              name = "sub-test-oneof-bool"
              parameter_value {
                bool_value = true
              }
            }
          }
        }
      }
    }
    sub_parameters {
      name         = "sub-oneof-number"
      display_name = "Sub Oneof Number"
      description  = "A sub-parameter for oneof number"
      value_type   = "ONEOF"
      is_required  = true
      default_value {
        oneof_value {
          name = "sub-test-oneof-number"
          parameter_value {
            number_value = 123.45
          }
        }
      }
      validation {
        allowed_values {
          values {
            oneof_value {
              name = "sub-test-oneof-number"
              parameter_value {
                number_value = 123.45
              }
            }
          }
        }
      }
    }
    sub_parameters {
      name         = "sub-oneof-string"
      display_name = "Sub Oneof String"
      description  = "A sub-parameter for oneof string"
      value_type   = "ONEOF"
      is_required  = true
      default_value {
        oneof_value {
          name = "sub-test-oneof-string"
          parameter_value {
            string_value = "test"
          }
        }
      }
      validation {
        allowed_values {
          values {
            oneof_value {
              name = "sub-test-oneof-string"
              parameter_value {
                string_value = "test"
              }
            }
          }
        }
      }
    }
    sub_parameters {
      name         = "sub-placeholder"
      display_name = "Sub Placeholder"
      description  = "A sub-parameter for placeholder"
      value_type   = "STRING"
      is_required  = true
      default_value {
        string_value = "test"
      }
      substitution_rules {
        placeholder_substitution_rule {
          attribute = "{{name}}"
        }
      }
    }
  }

  parameter_spec {
    name         = "full-parameter"
    display_name = "Full Parameter"
    description  = "A parameter testing all fields"
    value_type   = "ONEOF"
    is_required  = true
    default_value {
      oneof_value {
        name = "test-oneof"
        parameter_value {
          string_list_value {
            values = ["val1", "val2"]
          }
        }
      }
    }
    sub_parameters {
      name         = "sub-parameter"
      display_name = "Sub Parameter"
      description  = "A sub-parameter testing all fields"
      value_type   = "ONEOF"
      is_required  = true
      default_value {
        number_value = 50
      }
      substitution_rules {
        placeholder_substitution_rule {
          attribute = "{{name}}"
        }
      }
      validation {
        int_range {
          max = "100"
          min = "1"
        }
      }
    }
    validation {
      allowed_values {
        values {
          oneof_value {
            name = "test-oneof"
            parameter_value {
              string_list_value {
                values = ["val1", "val2"]
              }
            }
          }
        }
      }
    }
  }
}
`, context)
}

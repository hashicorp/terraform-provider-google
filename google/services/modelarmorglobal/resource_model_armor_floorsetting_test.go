// Copyright (c) HashiCorp, Inc.
// SPDX-License-Identifier: MPL-2.0
// ----------------------------------------------------------------------------
//
//	***     AUTO GENERATED CODE    ***    Type: Handwritten     ***
//
// ----------------------------------------------------------------------------
//
//	This code is generated by Magic Modules using the following:
//
//	Source file: https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/terraform/services/modelarmorglobal/resource_model_armor_floorsetting_test.go
//
//	DO NOT EDIT this file directly. Any changes made to this file will be
//	overwritten during the next generation cycle.
//
// ----------------------------------------------------------------------------
package modelarmorglobal_test

import (
	"testing"

	"github.com/hashicorp/terraform-plugin-testing/helper/resource"

	"github.com/hashicorp/terraform-plugin-testing/plancheck"

	"github.com/hashicorp/terraform-provider-google/google/acctest"

	"github.com/hashicorp/terraform-provider-google/google/envvar"
)

func TestAccModelArmorGlobalFloorsetting_update(t *testing.T) {
	t.Parallel()

	context := map[string]interface{}{
		"project_id": acctest.BootstrapProject(t, "tf-boot-modelarmor-", envvar.GetTestBillingAccountFromEnv(t), []string{"modelarmor.googleapis.com"}).ProjectId,
	}

	acctest.VcrTest(t, resource.TestCase{
		PreCheck:                 func() { acctest.AccTestPreCheck(t) },
		ProtoV5ProviderFactories: acctest.ProtoV5ProviderFactories(t),
		Steps: []resource.TestStep{
			{
				Config: testAccModelArmorGlobalFloorsetting_initial(context),
			},
			{
				ResourceName:            "google_model_armor_floorsetting.test-resource",
				ImportState:             true,
				ImportStateVerify:       true,
				ImportStateVerifyIgnore: []string{"location", "parent"},
			},
			{
				// Update from inspect_only to inspect_and_block = true for both ai_platform and google_mcp_server
				Config: testAccModelArmorGlobalFloorsetting_enableInspectAndBlock(context),
				ConfigPlanChecks: resource.ConfigPlanChecks{
					PreApply: []plancheck.PlanCheck{
						plancheck.ExpectResourceAction("google_model_armor_floorsetting.test-resource", plancheck.ResourceActionUpdate),
					},
				},
			},
			{
				ResourceName:            "google_model_armor_floorsetting.test-resource",
				ImportState:             true,
				ImportStateVerify:       true,
				ImportStateVerifyIgnore: []string{"location", "parent"},
			},
			{
				Config: testAccModelArmorGlobalFloorsetting_updated(context),
				ConfigPlanChecks: resource.ConfigPlanChecks{
					PreApply: []plancheck.PlanCheck{
						plancheck.ExpectResourceAction("google_model_armor_floorsetting.test-resource", plancheck.ResourceActionUpdate),
					},
				},
			},
			{
				ResourceName:            "google_model_armor_floorsetting.test-resource",
				ImportState:             true,
				ImportStateVerify:       true,
				ImportStateVerifyIgnore: []string{"location", "parent"},
			},
		},
	})
}

func testAccModelArmorGlobalFloorsetting_initial(context map[string]interface{}) string {
	return acctest.Nprintf(`
resource "google_model_armor_floorsetting" "test-resource" {
  location    = "global"
  parent      = "projects/%{project_id}"

  filter_config {
    rai_settings {
      rai_filters {
        filter_type      = "DANGEROUS"
        confidence_level = "LOW_AND_ABOVE"
      }
    }
    sdp_settings {
      basic_config {
        filter_enforcement = "ENABLED"
      }
    }
    pi_and_jailbreak_filter_settings {
      filter_enforcement = "ENABLED"
      confidence_level   = "MEDIUM_AND_ABOVE"
    }
    malicious_uri_filter_settings {
      filter_enforcement = "ENABLED"
    }
  }

  enable_floor_setting_enforcement = true
  
  integrated_services =  [ "AI_PLATFORM", "GOOGLE_MCP_SERVER" ]

  ai_platform_floor_setting {
    inspect_only            = true
    enable_cloud_logging    = true
  }

  google_mcp_server_floor_setting {
    inspect_only            = true
    enable_cloud_logging    = true
  }
  
  floor_setting_metadata {
    multi_language_detection {
      enable_multi_language_detection = true
    }
  }
}
`, context)
}

func testAccModelArmorGlobalFloorsetting_enableInspectAndBlock(context map[string]interface{}) string {
	return acctest.Nprintf(`
resource "google_model_armor_floorsetting" "test-resource" {
  location    = "global"
  parent      = "projects/%{project_id}"

  filter_config {
    rai_settings {
      rai_filters {
        filter_type      = "DANGEROUS"
        confidence_level = "LOW_AND_ABOVE"
      }
    }
    sdp_settings {
      basic_config {
        filter_enforcement = "ENABLED"
      }
    }
    pi_and_jailbreak_filter_settings {
      filter_enforcement = "ENABLED"
      confidence_level   = "MEDIUM_AND_ABOVE"
    }
    malicious_uri_filter_settings {
      filter_enforcement = "ENABLED"
    }
  }

  enable_floor_setting_enforcement = true
  integrated_services =  [ "AI_PLATFORM", "GOOGLE_MCP_SERVER" ]

  ai_platform_floor_setting {
    inspect_and_block            = true
    enable_cloud_logging    = true
  }

  google_mcp_server_floor_setting {
    inspect_and_block       = true
    enable_cloud_logging    = true
  }

  floor_setting_metadata {
    multi_language_detection {
      enable_multi_language_detection = true
    }
  }
}
`, context)
}

func testAccModelArmorGlobalFloorsetting_updated(context map[string]interface{}) string {
	return acctest.Nprintf(`
resource "google_model_armor_floorsetting" "test-resource" {
  location    = "global"
  parent      = "projects/%{project_id}"

  filter_config {
    rai_settings {
      rai_filters {
        filter_type      = "SEXUALLY_EXPLICIT"
        confidence_level = "HIGH"
      }
    }
    sdp_settings {
      advanced_config {
        inspect_template    = "projects/modelarmor-api-test/locations/global/inspectTemplates/modelarmor-tf-test"
        deidentify_template = "projects/modelarmor-api-test/locations/us-central1/deidentifyTemplates/modelarmor-tf-test"
      }
    }
    pi_and_jailbreak_filter_settings {
      filter_enforcement = "ENABLED"
      confidence_level   = "MEDIUM_AND_ABOVE"
    }
    malicious_uri_filter_settings {
      filter_enforcement = "ENABLED"
    }
  }
  
  floor_setting_metadata {
    multi_language_detection {
      enable_multi_language_detection = false
    }
  }
}
`, context)
}
